<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WebOS - Complete Desktop Environment</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            overflow: hidden;
            height: 100vh;
            background: #000;
        }

        /* Boot Screen */
        .boot-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #1e3c72, #2a5298);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            color: white;
        }

        .boot-logo {
            font-size: 4rem;
            font-weight: bold;
            margin-bottom: 2rem;
            text-shadow: 0 0 20px rgba(255,255,255,0.5);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .boot-progress {
            width: 300px;
            height: 6px;
            background: rgba(255,255,255,0.2);
            border-radius: 3px;
            overflow: hidden;
            margin-bottom: 1rem;
        }

        .boot-progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #00ff88, #00cc66);
            width: 0%;
            transition: width 0.3s ease;
        }

        .boot-text {
            font-size: 1rem;
            opacity: 0.8;
        }

        /* Login Screen */
        .login-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 9999;
        }

        .login-container {
            background: rgba(255,255,255,0.95);
            padding: 3rem;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
            text-align: center;
            min-width: 350px;
            backdrop-filter: blur(10px);
        }

        .login-avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea, #764ba2);
            margin: 0 auto 1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            color: white;
            animation: float 3s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }

        .login-input {
            width: 100%;
            padding: 12px;
            margin: 10px 0;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
            outline: none;
            transition: all 0.3s;
        }

        .login-input:focus {
            border-color: #667eea;
            box-shadow: 0 0 10px rgba(102, 126, 234, 0.3);
        }

        .login-btn {
            width: 100%;
            padding: 12px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s;
        }

        .login-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }

        /* Desktop Environment */
        .desktop {
            width: 100%;
            height: 100vh;
            background: var(--desktop-bg, linear-gradient(135deg, #2c3e50 0%, #34495e 100%));
            position: relative;
            display: none;
            flex-direction: column;
        }

        .desktop.wallpaper-1 { --desktop-bg: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .desktop.wallpaper-2 { --desktop-bg: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); }
        .desktop.wallpaper-3 { --desktop-bg: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); }
        .desktop.wallpaper-4 { --desktop-bg: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%); }
        .desktop.wallpaper-5 { --desktop-bg: linear-gradient(135deg, #fa709a 0%, #fee140 100%); }

        /* Theme Variables */
        .desktop.theme-dark {
            --window-bg: #2d3748;
            --window-header: #1a202c;
            --text-color: #e2e8f0;
            --border-color: #4a5568;
            --taskbar-bg: linear-gradient(to bottom, #2d3748, #1a202c);
        }

        .desktop.theme-light {
            --window-bg: #ffffff;
            --window-header: #f7fafc;
            --text-color: #2d3748;
            --border-color: #e2e8f0;
            --taskbar-bg: linear-gradient(to bottom, #f7fafc, #edf2f7);
        }

        .desktop.theme-retro {
            --window-bg: #000000;
            --window-header: #008000;
            --text-color: #00ff00;
            --border-color: #008000;
            --taskbar-bg: linear-gradient(to bottom, #008000, #004000);
        }

        .desktop.theme-neon {
            --window-bg: #0a0a0a;
            --window-header: #1a1a2e;
            --text-color: #00ffff;
            --border-color: #ff00ff;
            --taskbar-bg: linear-gradient(to bottom, #1a1a2e, #16213e);
        }

        /* Desktop Icons */
        .desktop-icons {
            position: absolute;
            top: 20px;
            left: 20px;
            display: grid;
            grid-template-columns: repeat(auto-fit, 80px);
            gap: 20px;
            z-index: 10;
        }

        .desktop-icon {
            display: flex;
            flex-direction: column;
            align-items: center;
            cursor: pointer;
            padding: 10px;
            border-radius: 8px;
            transition: all 0.3s;
            color: white;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.7);
            user-select: none;
            position: relative;
        }

        .desktop-icon:hover {
            background-color: rgba(255,255,255,0.1);
            transform: scale(1.05) translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.3);
        }

        .desktop-icon.selected {
            background-color: rgba(255,255,255,0.2);
        }

        .icon {
            width: 48px;
            height: 48px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            margin-bottom: 5px;
            border: 2px solid rgba(255,255,255,0.3);
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
            transition: all 0.3s;
        }

        .desktop-icon:hover .icon {
            box-shadow: 0 8px 16px rgba(0,0,0,0.4);
            transform: rotateY(10deg);
        }

        .icon-label {
            font-size: 12px;
            text-align: center;
            max-width: 70px;
            word-wrap: break-word;
        }

        /* Taskbar */
        .taskbar {
            height: 50px;
            background: var(--taskbar-bg, linear-gradient(to bottom, #3a3a3a, #2a2a2a));
            border-top: 1px solid #555;
            display: flex;
            align-items: center;
            padding: 0 15px;
            position: fixed;
            bottom: 0;
            width: 100%;
            z-index: 1000;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.3);
            backdrop-filter: blur(10px);
        }

        .start-menu {
            background: linear-gradient(to bottom, #4a4a4a, #3a3a3a);
            color: white;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            margin-right: 10px;
            border: 1px solid #555;
            font-weight: bold;
            transition: all 0.3s;
        }

        .start-menu:hover {
            background: linear-gradient(to bottom, #5a5a5a, #4a4a4a);
            transform: translateY(-2px);
            box-shadow: 0 5px 10px rgba(0,0,0,0.3);
        }

        .taskbar-apps {
            display: flex;
            gap: 5px;
            flex: 1;
        }

        .taskbar-app {
            background: linear-gradient(to bottom, #4a4a4a, #3a3a3a);
            color: white;
            padding: 8px 12px;
            border-radius: 3px;
            cursor: pointer;
            border: 1px solid #555;
            font-size: 12px;
            transition: all 0.3s;
            max-width: 150px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .taskbar-app.active {
            background: linear-gradient(to bottom, #0078d4, #106ebe);
        }

        .taskbar-app:hover {
            transform: translateY(-2px);
        }

        .system-tray {
            display: flex;
            align-items: center;
            gap: 15px;
            color: white;
            font-size: 12px;
        }

        .system-tray-item {
            cursor: pointer;
            padding: 5px;
            border-radius: 3px;
            transition: all 0.3s;
        }

        .system-tray-item:hover {
            background-color: rgba(255,255,255,0.1);
            transform: scale(1.1);
        }

        /* Windows */
        .window {
            position: absolute;
            background: var(--window-bg, #1a1a1a);
            border-radius: 8px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            display: none;
            flex-direction: column;
            border: 1px solid var(--border-color, #333);
            min-width: 400px;
            min-height: 300px;
            z-index: 100;
            backdrop-filter: blur(10px);
        }

        .window.active {
            z-index: 200;
        }

        .window.maximized {
            top: 0 !important;
            left: 0 !important;
            width: 100% !important;
            height: calc(100% - 50px) !important;
            border-radius: 0 !important;
        }

        .window.minimized {
            display: none;
        }

        .window-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 10px 15px;
            background: var(--window-header, linear-gradient(to bottom, #3a3a3a, #2a2a2a));
            border-radius: 8px 8px 0 0;
            border-bottom: 1px solid var(--border-color, #555);
            cursor: move;
            user-select: none;
        }

        .window-title {
            color: var(--text-color, #ffffff);
            font-weight: bold;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .window-controls {
            display: flex;
            gap: 8px;
        }

        .window-btn {
            width: 16px;
            height: 16px;
            border-radius: 50%;
            cursor: pointer;
            border: 1px solid rgba(255,255,255,0.2);
            transition: all 0.3s;
        }

        .window-btn.minimize { background: linear-gradient(135deg, #ffd43b, #f39c12); }
        .window-btn.maximize { background: linear-gradient(135deg, #51cf66, #2ecc71); }
        .window-btn.close { background: linear-gradient(135deg, #ff6b6b, #e74c3c); }

        .window-btn:hover {
            transform: scale(1.3);
            box-shadow: 0 0 10px rgba(255,255,255,0.5);
        }

        .window-content {
            flex: 1;
            overflow: auto;
            background: var(--window-bg, #000000);
            border-radius: 0 0 8px 8px;
            color: var(--text-color, #ffffff);
        }

        /* Terminal Styles */
        .terminal-body {
            padding: 15px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            line-height: 1.4;
            height: 100%;
            overflow-y: auto;
            background: linear-gradient(135deg, #0c0c0c, #1a1a1a);
        }

        .output {
            white-space: pre-wrap;
            margin-bottom: 5px;
        }

        .input-line {
            display: flex;
            align-items: center;
        }

        .prompt-text {
            color: #00ff00;
            margin-right: 5px;
            font-weight: bold;
            text-shadow: 0 0 5px #00ff00;
        }

        .prompt-text.sudo {
            color: #ff6b6b;
            text-shadow: 0 0 5px #ff6b6b;
        }

        .input-field {
            background: transparent;
            border: none;
            color: var(--text-color, #ffffff);
            font-family: inherit;
            font-size: inherit;
            outline: none;
            flex: 1;
            caret-color: #00ff00;
        }

        .error { color: #ff6b6b; }
        .success { color: #51cf66; }
        .info { color: #74c0fc; }
        .warning { color: #ffd43b; }
        .ascii-art { color: #ff79c6; font-size: 12px; }
        .file { color: var(--text-color, #ffffff); }
        .directory { color: #74c0fc; font-weight: bold; }

        /* Snake Game Styles */
        .snake-game-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            height: 100%;
        }

        .snake-score {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 20px;
            color: var(--text-color, #fff);
        }

        .snake-board {
            display: grid;
            grid-template-columns: repeat(20, 20px);
            grid-template-rows: repeat(20, 20px);
            gap: 1px;
            background: var(--border-color, #555);
            border-radius: 8px;
            padding: 10px;
            margin-bottom: 20px;
        }

        .snake-cell {
            background: var(--window-bg, #1a1a1a);
            border-radius: 2px;
            transition: all 0.1s;
        }

        .snake-cell.snake {
            background: linear-gradient(135deg, #00ff88, #00cc66);
            box-shadow: 0 0 5px #00ff88;
        }

        .snake-cell.food {
            background: linear-gradient(135deg, #ff6b6b, #e74c3c);
            border-radius: 50%;
            box-shadow: 0 0 10px #ff6b6b;
            animation: pulse-food 1s infinite;
        }

        @keyframes pulse-food {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.2); }
        }

        .snake-controls {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
        }

        .snake-btn {
            padding: 10px 20px;
            background: linear-gradient(135deg, #0078d4, #106ebe);
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .snake-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,120,212,0.3);
        }

        /* Notifications */
        .notifications {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 9999;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .notification {
            background: rgba(0,0,0,0.9);
            color: white;
            padding: 15px 20px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            border-left: 4px solid #00ff88;
            min-width: 300px;
            animation: slideIn 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .notification.error {
            border-left-color: #ff6b6b;
        }

        .notification.warning {
            border-left-color: #ffd43b;
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        /* Context Menu */
        .context-menu {
            position: fixed;
            background: var(--window-bg, #2a2a2a);
            border: 1px solid var(--border-color, #555);
            border-radius: 4px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            z-index: 9998;
            display: none;
            min-width: 150px;
            backdrop-filter: blur(10px);
        }

        .context-menu-item {
            padding: 8px 12px;
            cursor: pointer;
            color: var(--text-color, #fff);
            transition: background-color 0.2s;
        }

        .context-menu-item:hover {
            background-color: rgba(255,255,255,0.1);
        }

        .context-menu-separator {
            height: 1px;
            background: var(--border-color, #555);
            margin: 4px 0;
        }

        /* Games */
        .game-container {
            padding: 20px;
            text-align: center;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .game-board {
            display: grid;
            gap: 2px;
            margin: 20px 0;
            background: var(--border-color, #555);
            border-radius: 4px;
            padding: 2px;
        }

        .tic-tac-toe {
            grid-template-columns: repeat(3, 60px);
            grid-template-rows: repeat(3, 60px);
        }

        .game-cell {
            background: var(--window-bg, #1a1a1a);
            border: none;
            color: var(--text-color, #fff);
            font-size: 24px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }

        .game-cell:hover {
            background-color: rgba(255,255,255,0.1);
            transform: scale(1.05);
        }

        /* Start Menu */
        .start-menu-panel {
            position: fixed;
            bottom: 50px;
            left: 15px;
            width: 300px;
            height: 400px;
            background: var(--window-bg, #2a2a2a);
            border: 1px solid var(--border-color, #555);
            border-radius: 8px;
            box-shadow: 0 8px 24px rgba(0,0,0,0.3);
            display: none;
            flex-direction: column;
            z-index: 9999;
            backdrop-filter: blur(10px);
        }

        .start-menu-header {
            padding: 15px;
            border-bottom: 1px solid var(--border-color, #555);
            color: var(--text-color, #fff);
            font-weight: bold;
            background: linear-gradient(135deg, #667eea, #764ba2);
        }

        .start-menu-apps {
            flex: 1;
            padding: 10px;
            overflow-y: auto;
        }

        .start-menu-app {
            display: flex;
            align-items: center;
            padding: 10px;
            cursor: pointer;
            border-radius: 4px;
            transition: all 0.3s;
        }

        .start-menu-app:hover {
            background-color: rgba(255,255,255,0.1);
            transform: translateX(5px);
        }

        .start-menu-icon {
            margin-right: 10px;
            font-size: 18px;
        }

        /* File Explorer */
        .file-explorer {
            display: flex;
            height: 100%;
        }

        .file-sidebar {
            width: 200px;
            background: var(--window-header, #2a2a2a);
            border-right: 1px solid var(--border-color, #555);
            padding: 10px;
        }

        .file-main {
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .file-toolbar {
            padding: 10px;
            border-bottom: 1px solid var(--border-color, #555);
            display: flex;
            gap: 10px;
            align-items: center;
            background: var(--window-header, #2a2a2a);
        }

        .file-content {
            flex: 1;
            padding: 10px;
            overflow: auto;
        }

        .file-item {
            display: flex;
            align-items: center;
            padding: 8px;
            cursor: pointer;
            border-radius: 4px;
            transition: all 0.3s;
        }

        .file-item:hover {
            background-color: rgba(255,255,255,0.1);
            transform: translateX(5px);
        }

        .file-item.selected {
            background-color: rgba(0,120,212,0.3);
        }

        .file-icon {
            margin-right: 10px;
            font-size: 16px;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .desktop-icons {
                grid-template-columns: repeat(auto-fit, 60px);
                gap: 15px;
            }
            
            .icon {
                width: 40px;
                height: 40px;
                font-size: 20px;
            }
            
            .window {
                min-width: 300px;
                min-height: 200px;
            }
        }

        /* Scrollbars */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(255,255,255,0.1);
        }

        ::-webkit-scrollbar-thumb {
            background: rgba(255,255,255,0.3);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: rgba(255,255,255,0.5);
        }

        /* Hidden elements */
        .hidden {
            display: none !important;
        }

        /* Music Player */
        .music-player {
            padding: 20px;
            text-align: center;
        }

        .music-controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin: 20px 0;
        }

        .music-btn {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            border: none;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            font-size: 20px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .music-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }

        /* Calculator */
        .calculator {
            padding: 20px;
            max-width: 300px;
            margin: 0 auto;
        }

        .calc-display {
            width: 100%;
            height: 60px;
            font-size: 24px;
            text-align: right;
            padding: 10px;
            margin-bottom: 20px;
            border: 1px solid var(--border-color, #555);
            border-radius: 5px;
            background: var(--window-bg, #1a1a1a);
            color: var(--text-color, #fff);
        }

        .calc-buttons {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
        }

        .calc-btn {
            height: 50px;
            border: none;
            border-radius: 5px;
            font-size: 18px;
            cursor: pointer;
            transition: all 0.3s;
            background: var(--window-header, #3a3a3a);
            color: var(--text-color, #fff);
        }

        .calc-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 3px 10px rgba(0,0,0,0.3);
        }

        .calc-btn.operator {
            background: linear-gradient(135deg, #667eea, #764ba2);
        }

        .calc-btn.equals {
            background: linear-gradient(135deg, #51cf66, #2ecc71);
        }
    </style>
</head>
<body>
    <!-- Boot Screen -->
    <div class="boot-screen" id="boot-screen">
        <div class="boot-logo">🐧 WebOS</div>
        <div class="boot-progress">
            <div class="boot-progress-bar" id="boot-progress"></div>
        </div>
        <div class="boot-text" id="boot-text">Initializing system...</div>
    </div>

    <!-- Login Screen -->
    <div class="login-screen" id="login-screen">
        <div class="login-container">
            <div class="login-avatar">🐧</div>
            <h2>Welcome to WebOS</h2>
            <input type="text" class="login-input" id="username" placeholder="Username" value="user">
            <input type="password" class="login-input" id="password" placeholder="Password" value="password">
            <button class="login-btn" onclick="login()">Sign In</button>
        </div>
    </div>

    <!-- Desktop Environment -->
    <div class="desktop theme-dark wallpaper-1" id="desktop">
        <!-- Desktop Icons -->
        <div class="desktop-icons" id="desktop-icons">
            <div class="desktop-icon" data-app="terminal" ondblclick="openApp('terminal')">
                <div class="icon">🖥️</div>
                <div class="icon-label">Terminal</div>
            </div>
            <div class="desktop-icon" data-app="file-explorer" ondblclick="openApp('file-explorer')">
                <div class="icon">📁</div>
                <div class="icon-label">Files</div>
            </div>
            <div class="desktop-icon" data-app="browser" ondblclick="openApp('browser')">
                <div class="icon">🌐</div>
                <div class="icon-label">Browser</div>
            </div>
            <div class="desktop-icon" data-app="code-editor" ondblclick="openApp('code-editor')">
                <div class="icon">📝</div>
                <div class="icon-label">Code Editor</div>
            </div>
            <div class="desktop-icon" data-app="system-monitor" ondblclick="openApp('system-monitor')">
                <div class="icon">📊</div>
                <div class="icon-label">System Monitor</div>
            </div>
            <div class="desktop-icon" data-app="games" ondblclick="openApp('games')">
                <div class="icon">🎮</div>
                <div class="icon-label">Games</div>
            </div>
            <div class="desktop-icon" data-app="music-player" ondblclick="openApp('music-player')">
                <div class="icon">🎵</div>
                <div class="icon-label">Music Player</div>
            </div>
            <div class="desktop-icon" data-app="calculator" ondblclick="openApp('calculator')">
                <div class="icon">🔢</div>
                <div class="icon-label">Calculator</div>
            </div>
            <div class="desktop-icon" data-app="email" ondblclick="openApp('email')">
                <div class="icon">📧</div>
                <div class="icon-label">Email</div>
            </div>
            <div class="desktop-icon" data-app="calendar" ondblclick="openApp('calendar')">
                <div class="icon">📅</div>
                <div class="icon-label">Calendar</div>
            </div>
            <div class="desktop-icon" data-app="settings" ondblclick="openApp('settings')">
                <div class="icon">⚙️</div>
                <div class="icon-label">Settings</div>
            </div>
            <div class="desktop-icon" data-app="recycle-bin" ondblclick="openApp('recycle-bin')">
                <div class="icon">🗑️</div>
                <div class="icon-label">Recycle Bin</div>
            </div>
        </div>

        <!-- Windows Container -->
        <div id="windows-container"></div>

        <!-- Taskbar -->
        <div class="taskbar">
            <div class="start-menu" onclick="toggleStartMenu()">🐧 Start</div>
            <div class="taskbar-apps" id="taskbar-apps"></div>
            <div class="system-tray">
                <div class="system-tray-item" onclick="openApp('system-monitor')" title="System Monitor">📊</div>
                <div class="system-tray-item" onclick="toggleVolume()" title="Volume">🔊</div>
                <div class="system-tray-item" onclick="toggleNetwork()" title="Network">📶</div>
                <div class="system-tray-item" onclick="toggleBattery()" title="Battery">🔋</div>
                <div class="system-tray-item" id="clock"></div>
            </div>
        </div>

        <!-- Start Menu -->
        <div class="start-menu-panel" id="start-menu-panel">
            <div class="start-menu-header">🐧 WebOS Applications</div>
            <div class="start-menu-apps">
                <div class="start-menu-app" onclick="openApp('terminal')">
                    <div class="start-menu-icon">🖥️</div>
                    <div>Terminal</div>
                </div>
                <div class="start-menu-app" onclick="openApp('file-explorer')">
                    <div class="start-menu-icon">📁</div>
                    <div>File Explorer</div>
                </div>
                <div class="start-menu-app" onclick="openApp('browser')">
                    <div class="start-menu-icon">🌐</div>
                    <div>Web Browser</div>
                </div>
                <div class="start-menu-app" onclick="openApp('code-editor')">
                    <div class="start-menu-icon">📝</div>
                    <div>Code Editor</div>
                </div>
                <div class="start-menu-app" onclick="openApp('system-monitor')">
                    <div class="start-menu-icon">📊</div>
                    <div>System Monitor</div>
                </div>
                <div class="start-menu-app" onclick="openApp('games')">
                    <div class="start-menu-icon">🎮</div>
                    <div>Games</div>
                </div>
                <div class="start-menu-app" onclick="openApp('music-player')">
                    <div class="start-menu-icon">🎵</div>
                    <div>Music Player</div>
                </div>
                <div class="start-menu-app" onclick="openApp('calculator')">
                    <div class="start-menu-icon">🔢</div>
                    <div>Calculator</div>
                </div>
                <div class="start-menu-app" onclick="openApp('email')">
                    <div class="start-menu-icon">📧</div>
                    <div>Email Client</div>
                </div>
                <div class="start-menu-app" onclick="openApp('calendar')">
                    <div class="start-menu-icon">📅</div>
                    <div>Calendar</div>
                </div>
                <div class="start-menu-app" onclick="openApp('settings')">
                    <div class="start-menu-icon">⚙️</div>
                    <div>Settings</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Notifications Container -->
    <div class="notifications" id="notifications"></div>

    <!-- Context Menu -->
    <div class="context-menu" id="context-menu">
        <div class="context-menu-item" onclick="openApp('terminal')">Open Terminal</div>
        <div class="context-menu-item" onclick="openApp('file-explorer')">Open File Explorer</div>
        <div class="context-menu-separator"></div>
        <div class="context-menu-item" onclick="refreshDesktop()">Refresh</div>
        <div class="context-menu-item" onclick="openApp('settings')">Settings</div>
        <div class="context-menu-separator"></div>
        <div class="context-menu-item" onclick="logout()">Logout</div>
    </div>

    <script>
        // Global Variables
        let currentUser = null;
        let fileSystem = {};
        let openWindows = {};
        let windowZIndex = 100;
        let draggedElement = null;
        let dragOffset = { x: 0, y: 0 };
        let selectedIcons = [];
        let clipboard = '';
        let systemStats = {
            cpu: 0,
            memory: 0,
            disk: 0
        };

        // Boot Sequence
        window.addEventListener('load', () => {
            startBootSequence();
        });

        function startBootSequence() {
            const bootSteps = [
                { text: 'Initializing WebOS kernel...', progress: 10 },
                { text: 'Loading system modules...', progress: 25 },
                { text: 'Starting desktop environment...', progress: 40 },
                { text: 'Mounting virtual file systems...', progress: 60 },
                { text: 'Loading applications...', progress: 80 },
                { text: 'WebOS ready! 🐧', progress: 100 }
            ];

            let currentStep = 0;
            const bootInterval = setInterval(() => {
                if (currentStep < bootSteps.length) {
                    const step = bootSteps[currentStep];
                    document.getElementById('boot-text').textContent = step.text;
                    document.getElementById('boot-progress').style.width = step.progress + '%';
                    currentStep++;
                } else {
                    clearInterval(bootInterval);
                    setTimeout(() => {
                        document.getElementById('boot-screen').style.display = 'none';
                        document.getElementById('login-screen').style.display = 'flex';
                    }, 500);
                }
            }, 800);
        }

        // Login System
        function login() {
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;

            if (username && password) {
                currentUser = username;
                document.getElementById('login-screen').style.display = 'none';
                document.getElementById('desktop').style.display = 'flex';
                initializeDesktop();
                loadFileSystem();
                showNotification('🐧 Welcome to WebOS! Enjoy your Linux-like experience!', 'success');
            } else {
                showNotification('Please enter username and password', 'error');
            }
        }

        function logout() {
            currentUser = null;
            saveFileSystem();
            document.getElementById('desktop').style.display = 'none';
            document.getElementById('login-screen').style.display = 'flex';
            closeAllWindows();
            showNotification('Logged out successfully', 'info');
        }

        // Desktop Initialization
        function initializeDesktop() {
            updateClock();
            setInterval(updateClock, 1000);
            setInterval(updateSystemStats, 2000);
            setupEventListeners();
        }

        function updateClock() {
            const now = new Date();
            const timeString = now.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
            const dateString = now.toLocaleDateString();
            document.getElementById('clock').textContent = `${timeString} ${dateString}`;
        }

        function updateSystemStats() {
            systemStats.cpu = Math.random() * 100;
            systemStats.memory = Math.random() * 100;
            systemStats.disk = 45 + Math.random() * 20;
        }

        // Event Listeners
        function setupEventListeners() {
            document.addEventListener('keydown', handleKeyboardShortcuts);
            document.addEventListener('contextmenu', showContextMenu);
            document.addEventListener('click', hideContextMenu);
            document.addEventListener('mousedown', startDrag);
            document.addEventListener('mousemove', drag);
            document.addEventListener('mouseup', endDrag);
        }

        function handleKeyboardShortcuts(e) {
            if (e.ctrlKey) {
                switch(e.key) {
                    case 'c':
                        if (e.target.tagName !== 'INPUT' && e.target.tagName !== 'TEXTAREA') {
                            e.preventDefault();
                            copyToClipboard();
                        }
                        break;
                    case 'v':
                        if (e.target.tagName !== 'INPUT' && e.target.tagName !== 'TEXTAREA') {
                            e.preventDefault();
                            pasteFromClipboard();
                        }
                        break;
                    case 'l':
                        e.preventDefault();
                        if (openWindows['terminal']) {
                            clearTerminal();
                        }
                        break;
                }
            }
        }

        // Notification System
        function showNotification(message, type = 'info', duration = 3000) {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.textContent = message;
            
            document.getElementById('notifications').appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, duration);
        }

        // File System
        function loadFileSystem() {
            const saved = localStorage.getItem(`webos_fs_${currentUser}`);
            if (saved) {
                fileSystem = JSON.parse(saved);
            } else {
                fileSystem = {
                    '/': {
                        'home': {
                            [currentUser]: {
                                'Documents': {
                                    'readme.txt': 'Welcome to WebOS! 🐧\n\nThis is a complete Linux-like desktop environment running in your browser.\n\nFeatures:\n- Full terminal with 40+ commands\n- File system with persistence\n- Multiple applications\n- Games and entertainment\n- Customizable themes\n\nEnjoy exploring!',
                                    'todo.txt': 'WebOS Todo List:\n✅ Complete desktop environment\n✅ Terminal with Linux commands\n✅ File management system\n✅ Games and applications\n✅ Theme customization\n🔄 Add more features\n🔄 Improve performance\n📝 Write documentation'
                                },
                                'Downloads': {},
                                'Pictures': {},
                                'Music': {
                                    'sample.mp3': 'Audio file placeholder'
                                },
                                'Videos': {},
                                'Desktop': {}
                            }
                        },
                        'etc': {
                            'passwd': 'root:x:0:0:root:/root:/bin/bash\nuser:x:1000:1000:user:/home/user:/bin/bash',
                            'hosts': '127.0.0.1 localhost webos.local\n::1 localhost',
                            'os-release': 'NAME="WebOS"\nVERSION="3.0"\nID=webos\nPRETTY_NAME="WebOS 3.0 (Penguin)"\nVERSION_ID="3.0"'
                        },
                        'usr': {
                            'bin': {
                                'bash': 'Bash shell executable',
                                'ls': 'List directory contents',
                                'cat': 'Display file contents',
                                'nano': 'Text editor'
                            },
                            'local': {},
                            'share': {
                                'applications': {}
                            }
                        },
                        'var': {
                            'log': {
                                'system.log': 'WebOS system log\n[INFO] System started\n[INFO] Desktop environment loaded\n[INFO] User logged in'
                            }
                        },
                        'tmp': {}
                    }
                };
            }
        }

        function saveFileSystem() {
            localStorage.setItem(`webos_fs_${currentUser}`, JSON.stringify(fileSystem));
        }

        function getDirectoryFromPath(path) {
            if (path === '/') return fileSystem['/'];
            
            const parts = path.split('/').filter(p => p);
            let current = fileSystem['/'];
            
            for (const part of parts) {
                if (!current || typeof current !== 'object' || !current[part]) {
                    return null;
                }
                current = current[part];
            }
            
            return current;
        }

        // Window Management
        function createWindow(appId, title, content, width = 600, height = 400) {
            if (openWindows[appId]) {
                focusWindow(appId);
                return;
            }

            const window = document.createElement('div');
            window.className = 'window active';
            window.id = `${appId}-window`;
            window.style.width = width + 'px';
            window.style.height = height + 'px';
            window.style.left = (Math.random() * 200 + 100) + 'px';
            window.style.top = (Math.random() * 100 + 50) + 'px';
            window.style.zIndex = ++windowZIndex;
            window.style.display = 'flex';

            window.innerHTML = `
                <div class="window-header" data-window="${appId}">
                    <div class="window-title">
                        <span>${getAppIcon(appId)}</span>
                        <span>${title}</span>
                    </div>
                    <div class="window-controls">
                        <div class="window-btn minimize" onclick="minimizeWindow('${appId}')"></div>
                        <div class="window-btn maximize" onclick="toggleMaximize('${appId}')"></div>
                        <div class="window-btn close" onclick="closeWindow('${appId}')"></div>
                    </div>
                </div>
                <div class="window-content" id="${appId}-content">
                    ${content}
                </div>
            `;

            document.getElementById('windows-container').appendChild(window);
            openWindows[appId] = {
                element: window,
                title: title,
                minimized: false,
                maximized: false
            };

            addToTaskbar(appId, title);
            return window;
        }

        function closeWindow(appId) {
            if (openWindows[appId]) {
                openWindows[appId].element.remove();
                delete openWindows[appId];
                removeFromTaskbar(appId);
            }
        }

        function minimizeWindow(appId) {
            if (openWindows[appId]) {
                openWindows[appId].element.classList.add('minimized');
                openWindows[appId].minimized = true;
                updateTaskbarApp(appId);
            }
        }

        function toggleMaximize(appId) {
            if (openWindows[appId]) {
                const window = openWindows[appId].element;
                const isMaximized = window.classList.contains('maximized');
                
                if (isMaximized) {
                    window.classList.remove('maximized');
                    openWindows[appId].maximized = false;
                } else {
                    window.classList.add('maximized');
                    openWindows[appId].maximized = true;
                }
            }
        }

        function focusWindow(appId) {
            if (openWindows[appId]) {
                const window = openWindows[appId].element;
                window.style.zIndex = ++windowZIndex;
                window.classList.remove('minimized');
                openWindows[appId].minimized = false;
                
                document.querySelectorAll('.window').forEach(w => w.classList.remove('active'));
                window.classList.add('active');
                updateTaskbarApp(appId);
            }
        }

        function closeAllWindows() {
            Object.keys(openWindows).forEach(appId => {
                closeWindow(appId);
            });
        }

        // Taskbar Management
        function addToTaskbar(appId, title) {
            const taskbarApps = document.getElementById('taskbar-apps');
            const app = document.createElement('div');
            app.className = 'taskbar-app active';
            app.id = `taskbar-${appId}`;
            app.innerHTML = `${getAppIcon(appId)} ${title}`;
            app.onclick = () => focusWindow(appId);
            taskbarApps.appendChild(app);
        }

        function removeFromTaskbar(appId) {
            const app = document.getElementById(`taskbar-${appId}`);
            if (app) app.remove();
        }

        function updateTaskbarApp(appId) {
            const app = document.getElementById(`taskbar-${appId}`);
            if (app) {
                const isMinimized = openWindows[appId]?.minimized;
                app.classList.toggle('active', !isMinimized);
            }
        }

        function getAppIcon(appId) {
            const icons = {
                'terminal': '🖥️',
                'file-explorer': '📁',
                'browser': '🌐',
                'code-editor': '📝',
                'system-monitor': '📊',
                'games': '🎮',
                'music-player': '🎵',
                'calculator': '🔢',
                'email': '📧',
                'calendar': '📅',
                'settings': '⚙️',
                'recycle-bin': '🗑️'
            };
            return icons[appId] || '📄';
        }

        // App Launcher
        function openApp(appId) {
            console.log('Opening app:', appId);
            
            switch(appId) {
                case 'terminal':
                    openTerminal();
                    break;
                case 'file-explorer':
                    openFileExplorer();
                    break;
                case 'browser':
                    openBrowser();
                    break;
                case 'code-editor':
                    openCodeEditor();
                    break;
                case 'system-monitor':
                    openSystemMonitor();
                    break;
                case 'games':
                    openGames();
                    break;
                case 'music-player':
                    openMusicPlayer();
                    break;
                case 'calculator':
                    openCalculator();
                    break;
                case 'email':
                    openEmail();
                    break;
                case 'calendar':
                    openCalendar();
                    break;
                case 'settings':
                    openSettings();
                    break;
                case 'recycle-bin':
                    openRecycleBin();
                    break;
                default:
                    showNotification(`App ${appId} not implemented yet`, 'warning');
            }
        }

        // Terminal Application
        function openTerminal() {
            const content = `
                <div class="terminal-body" id="terminal-body">
                    <div class="output">🐧 Welcome to WebOS Terminal v3.0 - Linux-like Experience</div>
                    <div class="output">Type 'help' to see available commands or 'neofetch' for system info.</div>
                    <div class="output"></div>
                    <div class="input-line">
                        <span class="prompt-text" id="prompt">user@webos:~$</span>
                        <input type="text" class="input-field" id="command-input" autocomplete="off" spellcheck="false">
                    </div>
                </div>
            `;
            
            const window = createWindow('terminal', 'Terminal', content, 700, 500);
            if (window) {
                initializeTerminal();
            }
        }

        function initializeTerminal() {
            const terminal = new WebTerminal();
            window.webTerminal = terminal;
        }

        // Music Player Application
        function openMusicPlayer() {
            const content = `
                <div class="music-player">
                    <h2>🎵 WebOS Music Player</h2>
                    <div style="margin: 20px 0;">
                        <div style="font-size: 18px; margin-bottom: 10px;">Now Playing:</div>
                        <div style="font-size: 24px; font-weight: bold; color: #667eea;">WebOS Theme Song</div>
                        <div style="color: #888;">Artist: WebOS Orchestra</div>
                    </div>
                    <div class="music-controls">
                        <button class="music-btn" onclick="musicAction('prev')" title="Previous">⏮️</button>
                        <button class="music-btn" onclick="musicAction('play')" title="Play/Pause" id="play-btn">▶️</button>
                        <button class="music-btn" onclick="musicAction('next')" title="Next">⏭️</button>
                    </div>
                    <div style="margin: 20px 0;">
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <span>0:00</span>
                            <div style="flex: 1; height: 4px; background: #333; border-radius: 2px; position: relative;">
                                <div style="height: 100%; background: linear-gradient(90deg, #667eea, #764ba2); border-radius: 2px; width: 30%;"></div>
                            </div>
                            <span>3:45</span>
                        </div>
                    </div>
                    <div style="margin: 20px 0;">
                        <h3>Playlist</h3>
                        <div style="text-align: left; margin-top: 10px;">
                            <div style="padding: 8px; border-bottom: 1px solid #333; cursor: pointer;" onclick="showNotification('Playing: WebOS Theme Song', 'info')">🎵 WebOS Theme Song</div>
                            <div style="padding: 8px; border-bottom: 1px solid #333; cursor: pointer;" onclick="showNotification('Playing: Terminal Blues', 'info')">🎵 Terminal Blues</div>
                            <div style="padding: 8px; border-bottom: 1px solid #333; cursor: pointer;" onclick="showNotification('Playing: Code Symphony', 'info')">🎵 Code Symphony</div>
                            <div style="padding: 8px; border-bottom: 1px solid #333; cursor: pointer;" onclick="showNotification('Playing: Desktop Harmony', 'info')">🎵 Desktop Harmony</div>
                        </div>
                    </div>
                </div>
            `;
            
            createWindow('music-player', 'Music Player', content, 400, 500);
        }

        function musicAction(action) {
            const playBtn = document.getElementById('play-btn');
            switch(action) {
                case 'play':
                    if (playBtn.textContent === '▶️') {
                        playBtn.textContent = '⏸️';
                        showNotification('🎵 Playing music...', 'info');
                    } else {
                        playBtn.textContent = '▶️';
                        showNotification('⏸️ Music paused', 'info');
                    }
                    break;
                case 'prev':
                    showNotification('⏮️ Previous track', 'info');
                    break;
                case 'next':
                    showNotification('⏭️ Next track', 'info');
                    break;
            }
        }

        // Calculator Application
        function openCalculator() {
            const content = `
                <div class="calculator">
                    <input type="text" class="calc-display" id="calc-display" readonly value="0">
                    <div class="calc-buttons">
                        <button class="calc-btn" onclick="calcClear()">C</button>
                        <button class="calc-btn" onclick="calcClearEntry()">CE</button>
                        <button class="calc-btn" onclick="calcBackspace()">⌫</button>
                        <button class="calc-btn operator" onclick="calcOperation('/')">/</button>
                        
                        <button class="calc-btn" onclick="calcNumber('7')">7</button>
                        <button class="calc-btn" onclick="calcNumber('8')">8</button>
                        <button class="calc-btn" onclick="calcNumber('9')">9</button>
                        <button class="calc-btn operator" onclick="calcOperation('*')">×</button>
                        
                        <button class="calc-btn" onclick="calcNumber('4')">4</button>
                        <button class="calc-btn" onclick="calcNumber('5')">5</button>
                        <button class="calc-btn" onclick="calcNumber('6')">6</button>
                        <button class="calc-btn operator" onclick="calcOperation('-')">-</button>
                        
                        <button class="calc-btn" onclick="calcNumber('1')">1</button>
                        <button class="calc-btn" onclick="calcNumber('2')">2</button>
                        <button class="calc-btn" onclick="calcNumber('3')">3</button>
                        <button class="calc-btn operator" onclick="calcOperation('+')">+</button>
                        
                        <button class="calc-btn" onclick="calcNumber('0')" style="grid-column: span 2;">0</button>
                        <button class="calc-btn" onclick="calcDecimal()">.</button>
                        <button class="calc-btn equals" onclick="calcEquals()">=</button>
                    </div>
                </div>
            `;
            
            const window = createWindow('calculator', 'Calculator', content, 320, 450);
            if (window) {
                window.calculator = {
                    display: '0',
                    previousValue: null,
                    operation: null,
                    waitingForOperand: false
                };
            }
        }

        function calcNumber(num) {
            const calc = openWindows['calculator']?.element?.calculator;
            const display = document.getElementById('calc-display');
            if (!calc || !display) return;

            if (calc.waitingForOperand) {
                calc.display = num;
                calc.waitingForOperand = false;
            } else {
                calc.display = calc.display === '0' ? num : calc.display + num;
            }
            display.value = calc.display;
        }

        function calcOperation(nextOperation) {
            const calc = openWindows['calculator']?.element?.calculator;
            const display = document.getElementById('calc-display');
            if (!calc || !display) return;

            const inputValue = parseFloat(calc.display);

            if (calc.previousValue === null) {
                calc.previousValue = inputValue;
            } else if (calc.operation) {
                const currentValue = calc.previousValue || 0;
                const newValue = calcPerformOperation(currentValue, inputValue, calc.operation);

                calc.display = String(newValue);
                calc.previousValue = newValue;
                display.value = calc.display;
            }

            calc.waitingForOperand = true;
            calc.operation = nextOperation;
        }

        function calcEquals() {
            const calc = openWindows['calculator']?.element?.calculator;
            const display = document.getElementById('calc-display');
            if (!calc || !display) return;

            const inputValue = parseFloat(calc.display);

            if (calc.previousValue !== null && calc.operation) {
                const newValue = calcPerformOperation(calc.previousValue, inputValue, calc.operation);
                calc.display = String(newValue);
                calc.previousValue = null;
                calc.operation = null;
                calc.waitingForOperand = true;
                display.value = calc.display;
            }
        }

        function calcPerformOperation(firstValue, secondValue, operation) {
            switch (operation) {
                case '+': return firstValue + secondValue;
                case '-': return firstValue - secondValue;
                case '*': return firstValue * secondValue;
                case '/': return firstValue / secondValue;
                default: return secondValue;
            }
        }

        function calcClear() {
            const calc = openWindows['calculator']?.element?.calculator;
            const display = document.getElementById('calc-display');
            if (!calc || !display) return;

            calc.display = '0';
            calc.previousValue = null;
            calc.operation = null;
            calc.waitingForOperand = false;
            display.value = calc.display;
        }

        function calcClearEntry() {
            const calc = openWindows['calculator']?.element?.calculator;
            const display = document.getElementById('calc-display');
            if (!calc || !display) return;

            calc.display = '0';
            display.value = calc.display;
        }

        function calcBackspace() {
            const calc = openWindows['calculator']?.element?.calculator;
            const display = document.getElementById('calc-display');
            if (!calc || !display) return;

            calc.display = calc.display.slice(0, -1) || '0';
            display.value = calc.display;
        }

        function calcDecimal() {
            const calc = openWindows['calculator']?.element?.calculator;
            const display = document.getElementById('calc-display');
            if (!calc || !display) return;

            if (calc.waitingForOperand) {
                calc.display = '0.';
                calc.waitingForOperand = false;
            } else if (calc.display.indexOf('.') === -1) {
                calc.display += '.';
            }
            display.value = calc.display;
        }

        // File Explorer Application
        function openFileExplorer() {
            const content = `
                <div class="file-explorer">
                    <div class="file-sidebar">
                        <div style="padding: 10px; font-weight: bold; border-bottom: 1px solid var(--border-color, #555);">📁 Quick Access</div>
                        <div class="file-item" onclick="navigateToPath('/home/${currentUser}')">
                            <div class="file-icon">🏠</div>
                            <div>Home</div>
                        </div>
                        <div class="file-item" onclick="navigateToPath('/home/${currentUser}/Documents')">
                            <div class="file-icon">📄</div>
                            <div>Documents</div>
                        </div>
                        <div class="file-item" onclick="navigateToPath('/home/${currentUser}/Downloads')">
                            <div class="file-icon">📥</div>
                            <div>Downloads</div>
                        </div>
                        <div class="file-item" onclick="navigateToPath('/home/${currentUser}/Pictures')">
                            <div class="file-icon">🖼️</div>
                            <div>Pictures</div>
                        </div>
                        <div class="file-item" onclick="navigateToPath('/home/${currentUser}/Music')">
                            <div class="file-icon">🎵</div>
                            <div>Music</div>
                        </div>
                    </div>
                    <div class="file-main">
                        <div class="file-toolbar">
                            <button onclick="fileExplorerBack()">← Back</button>
                            <button onclick="fileExplorerUp()">↑ Up</button>
                            <input type="text" id="file-path" value="/home/${currentUser}" style="flex: 1; margin: 0 10px; padding: 5px; background: var(--window-bg, #1a1a1a); color: var(--text-color, #fff); border: 1px solid var(--border-color, #555); border-radius: 4px;">
                            <button onclick="fileExplorerRefresh()">🔄 Refresh</button>
                            <button onclick="fileExplorerNewFolder()">📁 New Folder</button>
                        </div>
                        <div class="file-content" id="file-content">
                            <!-- File listing will be populated here -->
                        </div>
                    </div>
                </div>
            `;
            
            const window = createWindow('file-explorer', 'File Explorer', content, 800, 600);
            if (window) {
                navigateToPath(`/home/${currentUser}`);
            }
        }

        function navigateToPath(path) {
            const pathInput = document.getElementById('file-path');
            const content = document.getElementById('file-content');
            
            if (pathInput) pathInput.value = path;
            if (content) content.innerHTML = '';
            
            const dir = getDirectoryFromPath(path);
            if (dir && typeof dir === 'object' && content) {
                Object.keys(dir).forEach(item => {
                    const itemPath = path === '/' ? `/${item}` : `${path}/${item}`;
                    const itemData = dir[item];
                    const isDirectory = typeof itemData === 'object';
                    
                    const fileItem = document.createElement('div');
                    fileItem.className = 'file-item';
                    fileItem.innerHTML = `
                        <div class="file-icon">${isDirectory ? '📁' : '📄'}</div>
                        <div>${item}</div>
                    `;
                    
                    if (isDirectory) {
                        fileItem.ondblclick = () => navigateToPath(itemPath);
                    } else {
                        fileItem.ondblclick = () => openFileInEditor(itemPath);
                    }
                    
                    content.appendChild(fileItem);
                });
            }
        }

        function openFileInEditor(filePath) {
            openCodeEditor();
            setTimeout(() => {
                const file = getDirectoryFromPath(filePath);
                if (file && typeof file === 'string') {
                    const editor = document.getElementById('editor-textarea');
                    if (editor) {
                        editor.value = file;
                        updateEditorStats();
                    }
                }
            }, 100);
        }

        function fileExplorerBack() {
            showNotification('Back functionality coming soon!', 'info');
        }

        function fileExplorerUp() {
            const pathInput = document.getElementById('file-path');
            if (pathInput) {
                const currentPath = pathInput.value;
                const parentPath = currentPath.substring(0, currentPath.lastIndexOf('/')) || '/';
                navigateToPath(parentPath);
            }
        }

        function fileExplorerRefresh() {
            const pathInput = document.getElementById('file-path');
            if (pathInput) {
                navigateToPath(pathInput.value);
            }
        }

        function fileExplorerNewFolder() {
            const folderName = prompt('Enter folder name:');
            if (folderName) {
                const pathInput = document.getElementById('file-path');
                const currentPath = pathInput.value;
                const dir = getDirectoryFromPath(currentPath);
                if (dir && typeof dir === 'object') {
                    dir[folderName] = {};
                    saveFileSystem();
                    navigateToPath(currentPath);
                    showNotification(`Folder '${folderName}' created`, 'success');
                }
            }
        }

        // Browser Application
        function openBrowser() {
            const content = `
                <div class="browser">
                    <div class="browser-toolbar">
                        <button class="browser-nav-btn" onclick="browserBack()">←</button>
                        <button class="browser-nav-btn" onclick="browserForward()">→</button>
                        <button class="browser-nav-btn" onclick="browserRefresh()">🔄</button>
                        <input type="text" class="browser-address" id="browser-address" value="https://webos.local" placeholder="Enter URL..." style="background: var(--window-bg, #1a1a1a); color: var(--text-color, #fff);">
                        <button class="browser-nav-btn" onclick="browserGo()">Go</button>
                    </div>
                    <div class="browser-content" id="browser-content" style="padding: 20px; overflow: auto;">
                        <h1>🌐 Welcome to WebOS Browser</h1>
                        <p>Experience the web in your Linux-like desktop environment!</p>
                        <h2>🔗 Quick Links</h2>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin: 20px 0;">
                            <div style="border: 1px solid var(--border-color, #555); padding: 15px; border-radius: 8px; cursor: pointer;" onclick="loadWebsite('home')">
                                <h3>🏠 WebOS Home</h3>
                                <p>Official WebOS homepage</p>
                            </div>
                            <div style="border: 1px solid var(--border-color, #555); padding: 15px; border-radius: 8px; cursor: pointer;" onclick="loadWebsite('news')">
                                <h3>📰 Tech News</h3>
                                <p>Latest technology updates</p>
                            </div>
                            <div style="border: 1px solid var(--border-color, #555); padding: 15px; border-radius: 8px; cursor: pointer;" onclick="loadWebsite('search')">
                                <h3>🔍 Search Engine</h3>
                                <p>Find anything on the web</p>
                            </div>
                            <div style="border: 1px solid var(--border-color, #555); padding: 15px; border-radius: 8px; cursor: pointer;" onclick="loadWebsite('social')">
                                <h3>👥 Social Hub</h3>
                                <p>Connect with others</p>
                            </div>
                        </div>
                        <hr style="margin: 20px 0; border-color: var(--border-color, #555);">
                        <h2>📊 System Information</h2>
                        <p><strong>User Agent:</strong> WebOS Browser 3.0 (Linux-like)</p>
                        <p><strong>Current Time:</strong> <span id="browser-time"></span></p>
                        <p><strong>System:</strong> WebOS Desktop Environment</p>
                        <p><strong>Kernel:</strong> WebOS 3.0 (Penguin Edition)</p>
                    </div>
                </div>
            `;
            
            const window = createWindow('browser', 'Web Browser', content, 900, 700);
            if (window) {
                setInterval(() => {
                    const timeElement = document.getElementById('browser-time');
                    if (timeElement) {
                        timeElement.textContent = new Date().toLocaleString();
                    }
                }, 1000);
            }
        }

        function loadWebsite(site) {
            const content = document.getElementById('browser-content');
            const address = document.getElementById('browser-address');
            
            const websites = {
                'home': {
                    url: 'https://webos.local',
                    content: `
                        <h1>🐧 Welcome to WebOS</h1>
                        <p style="font-size: 18px; margin: 20px 0;">The most advanced Linux-like desktop environment for the web!</p>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin: 30px 0;">
                            <div style="border: 1px solid var(--border-color, #555); padding: 20px; border-radius: 8px;">
                                <h3>🖥️ Full Desktop Experience</h3>
                                <p>Complete window management, taskbar, and desktop icons just like a real Linux distribution.</p>
                            </div>
                            <div style="border: 1px solid var(--border-color, #555); padding: 20px; border-radius: 8px;">
                                <h3>🐧 Linux Terminal</h3>
                                <p>Over 40 Linux commands including ls, cd, cat, grep, and many more!</p>
                            </div>
                            <div style="border: 1px solid var(--border-color, #555); padding: 20px; border-radius: 8px;">
                                <h3>🎮 Games & Apps</h3>
                                <p>Built-in games, music player, calculator, and productivity applications.</p>
                            </div>
                            <div style="border: 1px solid var(--border-color, #555); padding: 20px; border-radius: 8px;">
                                <h3>🎨 Customizable</h3>
                                <p>Multiple themes, wallpapers, and personalization options.</p>
                            </div>
                        </div>
                        <h2>🚀 Getting Started</h2>
                        <ol style="margin: 20px 0; padding-left: 20px;">
                            <li>Open the Terminal and try commands like 'neofetch' or 'ls'</li>
                            <li>Explore the File Explorer to see the virtual file system</li>
                            <li>Play games or use the calculator</li>
                            <li>Customize your desktop in Settings</li>
                        </ol>
                    `
                },
                'news': {
                    url: 'https://technews.webos',
                    content: `
                        <h1>📰 WebOS Tech News</h1>
                        <div style="margin: 20px 0;">
                            <article style="border-bottom: 1px solid var(--border-color, #555); padding: 20px 0;">
                                <h2>🐧 WebOS 3.0 "Penguin" Released!</h2>
                                <p style="color: #888; margin: 5px 0;"><small>Posted 2 hours ago by WebOS Team</small></p>
                                <p>The latest version of WebOS brings enhanced terminal capabilities, new applications, and improved performance. Features include a complete Snake game, advanced calculator, and music player.</p>
                            </article>
                            <article style="border-bottom: 1px solid var(--border-color, #555); padding: 20px 0;">
                                <h2>🎮 New Gaming Features Added</h2>
                                <p style="color: #888; margin: 5px 0;"><small>Posted 5 hours ago by Game Dev Team</small></p>
                                <p>WebOS now includes an enhanced gaming experience with Snake, Tic-Tac-Toe, and number guessing games. More games coming soon!</p>
                            </article>
                            <article style="border-bottom: 1px solid var(--border-color, #555); padding: 20px 0;">
                                <h2>🎵 Music Player Integration</h2>
                                <p style="color: #888; margin: 5px 0;"><small>Posted 1 day ago by Audio Team</small></p>
                                <p>The new built-in music player supports playlists and provides a complete audio experience within the WebOS environment.</p>
                            </article>
                        </div>
                    `
                },
                'search': {
                    url: 'https://search.webos',
                    content: `
                        <h1>🔍 WebOS Search</h1>
                        <div style="text-align: center; margin: 40px 0;">
                            <input type="text" placeholder="Search the WebOS ecosystem..." style="width: 60%; padding: 15px; font-size: 16px; border: 1px solid var(--border-color, #555); border-radius: 25px; background: var(--window-bg, #1a1a1a); color: var(--text-color, #fff);">
                            <button style="padding: 15px 30px; margin-left: 10px; background: linear-gradient(135deg, #667eea, #764ba2); color: white; border: none; border-radius: 25px; cursor: pointer;">Search</button>
                        </div>
                        <h2>🔥 Trending Searches</h2>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 10px; margin: 20px 0;">
                            <div style="padding: 10px; background: rgba(255,255,255,0.05); border-radius: 5px;">Terminal commands</div>
                            <div style="padding: 10px; background: rgba(255,255,255,0.05); border-radius: 5px;">Linux tutorials</div>
                            <div style="padding: 10px; background: rgba(255,255,255,0.05); border-radius: 5px;">WebOS games</div>
                            <div style="padding: 10px; background: rgba(255,255,255,0.05); border-radius: 5px;">File management</div>
                            <div style="padding: 10px; background: rgba(255,255,255,0.05); border-radius: 5px;">Desktop customization</div>
                            <div style="padding: 10px; background: rgba(255,255,255,0.05); border-radius: 5px;">System monitoring</div>
                        </div>
                    `
                },
                'social': {
                    url: 'https://social.webos',
                    content: `
                        <h1>👥 WebOS Social Hub</h1>
                        <div style="margin: 20px 0;">
                            <div style="border: 1px solid var(--border-color, #555); padding: 15px; margin: 10px 0; border-radius: 8px;">
                                <div style="display: flex; align-items: center; margin-bottom: 10px;">
                                    <div style="width: 40px; height: 40px; border-radius: 50%; background: linear-gradient(135deg, #667eea, #764ba2); display: flex; align-items: center; justify-content: center; margin-right: 10px;">🐧</div>
                                    <div>
                                        <strong>@webos_user</strong>
                                        <div style="font-size: 12px; color: #888;">2 minutes ago</div>
                                    </div>
                                </div>
                                <p>Just discovered the new Snake game in WebOS! 🐍 My high score is already 150 points! #WebOSGaming</p>
                            </div>
                            <div style="border: 1px solid var(--border-color, #555); padding: 15px; margin: 10px 0; border-radius: 8px;">
                                <div style="display: flex; align-items: center; margin-bottom: 10px;">
                                    <div style="width: 40px; height: 40px; border-radius: 50%; background: linear-gradient(135deg, #51cf66, #2ecc71); display: flex; align-items: center; justify-content: center; margin-right: 10px;">👨‍💻</div>
                                    <div>
                                        <strong>@developer_pro</strong>
                                        <div style="font-size: 12px; color: #888;">15 minutes ago</div>
                                    </div>
                                </div>
                                <p>The WebOS terminal is incredibly powerful! Love using 'neofetch' to show off the penguin ASCII art 🐧 #Linux #WebOS</p>
                            </div>
                            <div style="border: 1px solid var(--border-color, #555); padding: 15px; margin: 10px 0; border-radius: 8px;">
                                <div style="display: flex; align-items: center; margin-bottom: 10px;">
                                    <div style="width: 40px; height: 40px; border-radius: 50%; background: linear-gradient(135deg, #ff6b6b, #e74c3c); display: flex; align-items: center; justify-content: center; margin-right: 10px;">🎵</div>
                                    <div>
                                        <strong>@music_lover</strong>
                                        <div style="font-size: 12px; color: #888;">1 hour ago</div>
                                    </div>
                                </div>
                                <p>The new music player is fantastic! Perfect for coding sessions. Now playing: "Terminal Blues" 🎶</p>
                            </div>
                        </div>
                    `
                }
            };
            
            if (websites[site]) {
                address.value = websites[site].url;
                content.innerHTML = websites[site].content;
            }
        }

        function browserBack() {
            showNotification('← Navigating back...', 'info');
        }

        function browserForward() {
            showNotification('→ Navigating forward...', 'info');
        }

        function browserRefresh() {
            showNotification('🔄 Page refreshed', 'info');
        }

        function browserGo() {
            const address = document.getElementById('browser-address');
            if (address) {
                showNotification(`Navigating to ${address.value}`, 'info');
            }
        }

        // Code Editor Application
        function openCodeEditor() {
            const content = `
                <div class="code-editor">
                    <div class="editor-toolbar">
                        <button onclick="editorNew()" style="padding: 5px 10px; background: var(--window-header, #3a3a3a); color: var(--text-color, #fff); border: 1px solid var(--border-color, #555); border-radius: 3px; cursor: pointer;">📄 New</button>
                        <button onclick="editorOpen()" style="padding: 5px 10px; background: var(--window-header, #3a3a3a); color: var(--text-color, #fff); border: 1px solid var(--border-color, #555); border-radius: 3px; cursor: pointer;">📁 Open</button>
                        <button onclick="editorSave()" style="padding: 5px 10px; background: var(--window-header, #3a3a3a); color: var(--text-color, #fff); border: 1px solid var(--border-color, #555); border-radius: 3px; cursor: pointer;">💾 Save</button>
                        <select id="editor-language" style="padding: 5px; background: var(--window-header, #3a3a3a); color: var(--text-color, #fff); border: 1px solid var(--border-color, #555); border-radius: 3px;">
                            <option value="javascript">JavaScript</option>
                            <option value="html">HTML</option>
                            <option value="css">CSS</option>
                            <option value="python">Python</option>
                            <option value="bash">Bash</option>
                            <option value="json">JSON</option>
                            <option value="markdown">Markdown</option>
                        </select>
                        <button onclick="editorFormat()" style="padding: 5px 10px; background: var(--window-header, #3a3a3a); color: var(--text-color, #fff); border: 1px solid var(--border-color, #555); border-radius: 3px; cursor: pointer;">🎨 Format</button>
                        <span style="margin-left: auto; font-size: 12px;">Lines: <span id="line-count">1</span> | Chars: <span id="char-count">0</span></span>
                    </div>
                    <div class="editor-content">
                        <textarea class="editor-textarea" id="editor-textarea" placeholder="// Welcome to WebOS Code Editor
// Start coding your next project here!

console.log('Hello, WebOS!');" style="font-family: 'Courier New', monospace; line-height: 1.5;"></textarea>
                    </div>
                </div>
            `;
            
            const window = createWindow('code-editor', 'Code Editor', content, 800, 600);
            if (window) {
                initializeCodeEditor();
            }
        }

        function initializeCodeEditor() {
            const textarea = document.getElementById('editor-textarea');
            if (textarea) {
                textarea.addEventListener('input', updateEditorStats);
                textarea.addEventListener('keydown', handleEditorShortcuts);
                updateEditorStats();
            }
        }

        function updateEditorStats() {
            const textarea = document.getElementById('editor-textarea');
            const lineCount = document.getElementById('line-count');
            const charCount = document.getElementById('char-count');
            
            if (textarea && lineCount && charCount) {
                const lines = textarea.value.split('\n').length;
                const chars = textarea.value.length;
                lineCount.textContent = lines;
                charCount.textContent = chars;
            }
        }

        function handleEditorShortcuts(e) {
            if (e.ctrlKey) {
                switch(e.key) {
                    case 's':
                        e.preventDefault();
                        editorSave();
                        break;
                    case 'o':
                        e.preventDefault();
                        editorOpen();
                        break;
                    case 'n':
                        e.preventDefault();
                        editorNew();
                        break;
                }
            }
        }

        function editorNew() {
            const textarea = document.getElementById('editor-textarea');
            if (textarea) {
                textarea.value = '';
                updateEditorStats();
                showNotification('📄 New file created', 'success');
            }
        }

        function editorOpen() {
            const userHome = `/home/${currentUser}/Documents`;
            const dir = getDirectoryFromPath(userHome);
            if (dir) {
                const files = Object.keys(dir).filter(key => typeof dir[key] === 'string');
                if (files.length > 0) {
                    const filename = prompt('Select file to open:\n' + files.join('\n'));
                    if (filename && dir[filename]) {
                        const textarea = document.getElementById('editor-textarea');
                        if (textarea) {
                            textarea.value = dir[filename];
                            updateEditorStats();
                            showNotification(`📁 Opened ${filename}`, 'success');
                        }
                    }
                } else {
                    showNotification('No files found in Documents folder', 'warning');
                }
            }
        }

        function editorSave() {
            const textarea = document.getElementById('editor-textarea');
            if (textarea) {
                const content = textarea.value;
                const filename = prompt('Enter filename:', 'untitled.txt');
                if (filename) {
                    const userHome = `/home/${currentUser}/Documents`;
                    const dir = getDirectoryFromPath(userHome);
                    if (dir) {
                        dir[filename] = content;
                        saveFileSystem();
                        showNotification(`💾 File saved as ${filename}`, 'success');
                    }
                }
            }
        }

        function editorFormat() {
            showNotification('🎨 Code formatting applied', 'info');
        }

        // System Monitor Application
        function openSystemMonitor() {
            const content = `
                <div class="system-monitor">
                    <div class="monitor-section">
                        <div class="monitor-title">🖥️ CPU Usage</div>
                        <div class="progress-bar">
                            <div class="progress-fill" id="cpu-progress"></div>
                        </div>
                        <div id="cpu-text">0%</div>
                    </div>
                    <div class="monitor-section">
                        <div class="monitor-title">🧠 Memory Usage</div>
                        <div class="progress-bar">
                            <div class="progress-fill" id="memory-progress"></div>
                        </div>
                        <div id="memory-text">0%</div>
                    </div>
                    <div class="monitor-section">
                        <div class="monitor-title">💾 Disk Usage</div>
                        <div class="progress-bar">
                            <div class="progress-fill" id="disk-progress"></div>
                        </div>
                        <div id="disk-text">0%</div>
                    </div>
                    <div class="monitor-section">
                        <div class="monitor-title">🐧 System Information</div>
                        <div><strong>OS:</strong> WebOS 3.0 (Penguin Edition)</div>
                        <div><strong>Kernel:</strong> WebOS-Linux 5.15.0</div>
                        <div><strong>Desktop:</strong> WebOS Desktop Environment</div>
                        <div><strong>User:</strong> ${currentUser}</div>
                        <div><strong>Uptime:</strong> <span id="uptime"></span></div>
                        <div><strong>Processes:</strong> <span id="process-count">15</span></div>
                        <div><strong>Load Average:</strong> 0.15, 0.10, 0.05</div>
                    </div>
                    <div class="monitor-section">
                        <div class="monitor-title">🌐 Network Information</div>
                        <div><strong>Status:</strong> <span style="color: #51cf66;">Connected</span></div>
                        <div><strong>Interface:</strong> eth0</div>
                        <div><strong>IP Address:</strong> 192.168.1.100</div>
                        <div><strong>Download:</strong> <span id="download-speed">1.2 MB/s</span></div>
                        <div><strong>Upload:</strong> <span id="upload-speed">0.8 MB/s</span></div>
                    </div>
                </div>
            `;
            
            const window = createWindow('system-monitor', 'System Monitor', content, 600, 500);
            if (window) {
                updateSystemMonitorDisplay();
                setInterval(updateSystemMonitorDisplay, 1000);
            }
        }

        function updateSystemMonitorDisplay() {
            const cpuProgress = document.getElementById('cpu-progress');
            const memoryProgress = document.getElementById('memory-progress');
            const diskProgress = document.getElementById('disk-progress');
            const cpuText = document.getElementById('cpu-text');
            const memoryText = document.getElementById('memory-text');
            const diskText = document.getElementById('disk-text');
            const uptime = document.getElementById('uptime');
            const downloadSpeed = document.getElementById('download-speed');
            const uploadSpeed = document.getElementById('upload-speed');
            const processCount = document.getElementById('process-count');
            
            if (cpuProgress) {
                cpuProgress.style.width = systemStats.cpu + '%';
                cpuText.textContent = Math.round(systemStats.cpu) + '%';
            }
            
            if (memoryProgress) {
                memoryProgress.style.width = systemStats.memory + '%';
                memoryText.textContent = Math.round(systemStats.memory) + '%';
            }
            
            if (diskProgress) {
                diskProgress.style.width = systemStats.disk + '%';
                diskText.textContent = Math.round(systemStats.disk) + '%';
            }
            
            if (uptime) {
                const uptimeSeconds = Math.floor(performance.now() / 1000);
                const hours = Math.floor(uptimeSeconds / 3600);
                const minutes = Math.floor((uptimeSeconds % 3600) / 60);
                uptime.textContent = `${hours}h ${minutes}m`;
            }
            
            if (downloadSpeed) {
                downloadSpeed.textContent = (Math.random() * 2 + 0.5).toFixed(1) + ' MB/s';
            }
            
            if (uploadSpeed) {
                uploadSpeed.textContent = (Math.random() * 1 + 0.3).toFixed(1) + ' MB/s';
            }

            if (processCount) {
                processCount.textContent = Math.floor(Math.random() * 5) + 12;
            }
        }

        // Games Application
        function openGames() {
            const content = `
                <div class="game-container">
                    <h2>🎮 WebOS Games Hub</h2>
                    <p>Choose your adventure!</p>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin: 30px 0;">
                        <div style="border: 1px solid var(--border-color, #555); padding: 20px; border-radius: 8px; cursor: pointer; transition: all 0.3s;" onclick="startTicTacToe()" onmouseover="this.style.transform='scale(1.05)'" onmouseout="this.style.transform='scale(1)'">
                            <div style="font-size: 48px; margin-bottom: 10px;">🎯</div>
                            <h3>Tic-Tac-Toe</h3>
                            <p>Classic strategy game against AI</p>
                        </div>
                        <div style="border: 1px solid var(--border-color, #555); padding: 20px; border-radius: 8px; cursor: pointer; transition: all 0.3s;" onclick="startSnakeGame()" onmouseover="this.style.transform='scale(1.05)'" onmouseout="this.style.transform='scale(1)'">
                            <div style="font-size: 48px; margin-bottom: 10px;">🐍</div>
                            <h3>Snake Game</h3>
                            <p>Retro arcade classic with modern twist</p>
                        </div>
                        <div style="border: 1px solid var(--border-color, #555); padding: 20px; border-radius: 8px; cursor: pointer; transition: all 0.3s;" onclick="startGuessingGame()" onmouseover="this.style.transform='scale(1.05)'" onmouseout="this.style.transform='scale(1)'">
                            <div style="font-size: 48px; margin-bottom: 10px;">🔢</div>
                            <h3>Number Guess</h3>
                            <p>Test your intuition and luck</p>
                        </div>
                    </div>
                    <div id="game-area">
                        <p style="color: #888;">Select a game above to start playing!</p>
                    </div>
                </div>
            `;
            
            createWindow('games', 'Games Hub', content, 600, 700);
        }

        function startTicTacToe() {
            const gameArea = document.getElementById('game-area');
            if (gameArea) {
                gameArea.innerHTML = `
                    <h3>🎯 Tic-Tac-Toe</h3>
                    <p>You are X, AI is O. Get three in a row to win!</p>
                    <div class="game-board tic-tac-toe" id="tic-tac-toe-board">
                        ${Array(9).fill().map((_, i) => `<button class="game-cell" onclick="ticTacToeMove(${i})">${''}</button>`).join('')}
                    </div>
                    <div id="tic-tac-toe-status" style="margin: 15px 0; font-size: 18px; font-weight: bold;">Your turn (X)</div>
                    <div style="display: flex; gap: 10px; justify-content: center;">
                        <button onclick="resetTicTacToe()" style="padding: 10px 20px; background: linear-gradient(135deg, #667eea, #764ba2); color: white; border: none; border-radius: 5px; cursor: pointer;">🔄 Reset Game</button>
                        <button onclick="startTicTacToe()" style="padding: 10px 20px; background: linear-gradient(135deg, #51cf66, #2ecc71); color: white; border: none; border-radius: 5px; cursor: pointer;">🆕 New Game</button>
                    </div>
                `;
                
                window.ticTacToeBoard = Array(9).fill('');
                window.ticTacToeCurrentPlayer = 'X';
                window.ticTacToeGameActive = true;
            }
        }

        function ticTacToeMove(index) {
            if (window.ticTacToeBoard && window.ticTacToeBoard[index] === '' && 
                window.ticTacToeCurrentPlayer === 'X' && window.ticTacToeGameActive) {
                
                window.ticTacToeBoard[index] = 'X';
                const cells = document.querySelectorAll('#tic-tac-toe-board .game-cell');
                if (cells[index]) {
                    cells[index].textContent = 'X';
                    cells[index].style.color = '#51cf66';
                }
                
                if (checkTicTacToeWin('X')) {
                    const status = document.getElementById('tic-tac-toe-status');
                    if (status) {
                        status.textContent = '🎉 You win! Congratulations!';
                        status.style.color = '#51cf66';
                    }
                    window.ticTacToeGameActive = false;
                    showNotification('🎉 You won Tic-Tac-Toe!', 'success');
                    return;
                }
                
                if (window.ticTacToeBoard.every(cell => cell !== '')) {
                    const status = document.getElementById('tic-tac-toe-status');
                    if (status) {
                        status.textContent = '🤝 It\'s a tie! Good game!';
                        status.style.color = '#ffd43b';
                    }
                    window.ticTacToeGameActive = false;
                    return;
                }
                
                // AI move with slight delay for realism
                setTimeout(() => {
                    if (!window.ticTacToeGameActive) return;
                    
                    const emptyCells = window.ticTacToeBoard.map((cell, i) => cell === '' ? i : null).filter(i => i !== null);
                    if (emptyCells.length > 0) {
                        const aiMove = emptyCells[Math.floor(Math.random() * emptyCells.length)];
                        window.ticTacToeBoard[aiMove] = 'O';
                        const cells = document.querySelectorAll('#tic-tac-toe-board .game-cell');
                        if (cells[aiMove]) {
                            cells[aiMove].textContent = 'O';
                            cells[aiMove].style.color = '#ff6b6b';
                        }
                        
                        const status = document.getElementById('tic-tac-toe-status');
                        if (checkTicTacToeWin('O')) {
                            if (status) {
                                status.textContent = '🤖 AI wins! Better luck next time!';
                                status.style.color = '#ff6b6b';
                            }
                            window.ticTacToeGameActive = false;
                            showNotification('🤖 AI won this round!', 'info');
                        } else if (window.ticTacToeBoard.every(cell => cell !== '')) {
                            if (status) {
                                status.textContent = '🤝 It\'s a tie! Good game!';
                                status.style.color = '#ffd43b';
                            }
                            window.ticTacToeGameActive = false;
                        } else {
                            if (status) {
                                status.textContent = 'Your turn (X)';
                                status.style.color = 'var(--text-color, #fff)';
                            }
                        }
                    }
                }, 500);
            }
        }

        function checkTicTacToeWin(player) {
            const winPatterns = [
                [0, 1, 2], [3, 4, 5], [6, 7, 8], // rows
                [0, 3, 6], [1, 4, 7], [2, 5, 8], // columns
                [0, 4, 8], [2, 4, 6] // diagonals
            ];
            
            return winPatterns.some(pattern => 
                pattern.every(index => window.ticTacToeBoard[index] === player)
            );
        }

        function resetTicTacToe() {
            window.ticTacToeBoard = Array(9).fill('');
            window.ticTacToeCurrentPlayer = 'X';
            window.ticTacToeGameActive = true;
            const cells = document.querySelectorAll('#tic-tac-toe-board .game-cell');
            cells.forEach(cell => {
                cell.textContent = '';
                cell.style.color = 'var(--text-color, #fff)';
            });
            const status = document.getElementById('tic-tac-toe-status');
            if (status) {
                status.textContent = 'Your turn (X)';
                status.style.color = 'var(--text-color, #fff)';
            }
        }

        function startSnakeGame() {
            const gameArea = document.getElementById('game-area');
            if (gameArea) {
                gameArea.innerHTML = `
                    <div class="snake-game-container">
                        <h3>🐍 Snake Game</h3>
                        <div class="snake-score">Score: <span id="snake-score">0</span> | High Score: <span id="snake-high-score">${localStorage.getItem('snake-high-score') || 0}</span></div>
                        <div class="snake-controls">
                            <button class="snake-btn" onclick="toggleSnakeGame()" id="snake-play-btn">▶️ Start</button>
                            <button class="snake-btn" onclick="resetSnakeGame()">🔄 Reset</button>
                        </div>
                        <div class="snake-board" id="snake-board">
                            ${Array(400).fill().map((_, i) => `<div class="snake-cell" data-index="${i}"></div>`).join('')}
                        </div>
                        <div style="margin-top: 15px; font-size: 14px; color: #888;">
                            Use WASD or Arrow Keys to control the snake
                        </div>
                    </div>
                `;
                
                initializeSnakeGame();
            }
        }

        function initializeSnakeGame() {
            window.snakeGame = {
                snake: [42, 41, 40],
                direction: 'right',
                food: 100,
                score: 0,
                gameRunning: false,
                gameInterval: null
            };
            
            updateSnakeDisplay();
            generateSnakeFood();
            
            // Remove existing event listener to prevent duplicates
            document.removeEventListener('keydown', handleSnakeInput);
            document.addEventListener('keydown', handleSnakeInput);
        }

        function handleSnakeInput(e) {
            if (!window.snakeGame || !window.snakeGame.gameRunning) return;
            
            const key = e.key.toLowerCase();
            const directions = {
                'w': 'up', 'arrowup': 'up',
                's': 'down', 'arrowdown': 'down',
                'a': 'left', 'arrowleft': 'left',
                'd': 'right', 'arrowright': 'right'
            };
            
            const newDirection = directions[key];
            if (newDirection && isValidSnakeDirection(newDirection)) {
                window.snakeGame.direction = newDirection;
            }
        }

        function isValidSnakeDirection(newDirection) {
            const opposites = {
                'up': 'down', 'down': 'up',
                'left': 'right', 'right': 'left'
            };
            return opposites[newDirection] !== window.snakeGame.direction;
        }

        function toggleSnakeGame() {
            const playBtn = document.getElementById('snake-play-btn');
            if (!window.snakeGame.gameRunning) {
                window.snakeGame.gameRunning = true;
                playBtn.textContent = '⏸️ Pause';
                window.snakeGame.gameInterval = setInterval(moveSnake, 150);
                showNotification('🐍 Snake game started!', 'success');
            } else {
                window.snakeGame.gameRunning = false;
                playBtn.textContent = '▶️ Resume';
                clearInterval(window.snakeGame.gameInterval);
                showNotification('⏸️ Game paused', 'info');
            }
        }

        function moveSnake() {
            if (!window.snakeGame || !window.snakeGame.gameRunning) return;
            
            const head = window.snakeGame.snake[0];
            let newHead;
            
            switch(window.snakeGame.direction) {
                case 'up': newHead = head - 20; break;
                case 'down': newHead = head + 20; break;
                case 'left': newHead = head - 1; break;
                case 'right': newHead = head + 1; break;
            }
            
            // Check boundaries
            if (newHead < 0 || newHead >= 400 || 
                (window.snakeGame.direction === 'left' && head % 20 === 0) ||
                (window.snakeGame.direction === 'right' && head % 20 === 19) ||
                window.snakeGame.snake.includes(newHead)) {
                snakeGameOver();
                return;
            }
            
            window.snakeGame.snake.unshift(newHead);
            
            // Check food
            if (newHead === window.snakeGame.food) {
                window.snakeGame.score += 10;
                document.getElementById('snake-score').textContent = window.snakeGame.score;
                generateSnakeFood();
                
                // Check for high score
                const highScore = parseInt(localStorage.getItem('snake-high-score') || 0);
                if (window.snakeGame.score > highScore) {
                    localStorage.setItem('snake-high-score', window.snakeGame.score);
                    document.getElementById('snake-high-score').textContent = window.snakeGame.score;
                    showNotification('🏆 New high score!', 'success');
                }
            } else {
                window.snakeGame.snake.pop();
            }
            
            updateSnakeDisplay();
        }

        function updateSnakeDisplay() {
            const cells = document.querySelectorAll('#snake-board .snake-cell');
            cells.forEach(cell => {
                cell.className = 'snake-cell';
            });
            
            if (window.snakeGame) {
                window.snakeGame.snake.forEach((index, i) => {
                    if (cells[index]) {
                        cells[index].classList.add('snake');
                        if (i === 0) {
                            cells[index].style.background = 'linear-gradient(135deg, #00ff88, #00cc66)';
                        }
                    }
                });
                
                if (cells[window.snakeGame.food]) {
                    cells[window.snakeGame.food].classList.add('food');
                }
            }
        }

        function generateSnakeFood() {
            let newFood;
            do {
                newFood = Math.floor(Math.random() * 400);
            } while (window.snakeGame.snake.includes(newFood));
            
            window.snakeGame.food = newFood;
        }

        function snakeGameOver() {
            window.snakeGame.gameRunning = false;
            clearInterval(window.snakeGame.gameInterval);
            document.getElementById('snake-play-btn').textContent = '▶️ Start';
            showNotification(`🐍 Game Over! Final Score: ${window.snakeGame.score}`, 'warning');
        }

        function resetSnakeGame() {
            if (window.snakeGame && window.snakeGame.gameInterval) {
                clearInterval(window.snakeGame.gameInterval);
            }
            initializeSnakeGame();
            document.getElementById('snake-score').textContent = '0';
            document.getElementById('snake-play-btn').textContent = '▶️ Start';
            showNotification('🔄 Snake game reset', 'info');
        }

        function startGuessingGame() {
            const gameArea = document.getElementById('game-area');
            if (gameArea) {
                gameArea.innerHTML = `
                    <h3>🔢 Number Guessing Game</h3>
                    <p>I'm thinking of a number between 1 and 100!</p>
                    <div style="margin: 20px 0;">
                        <input type="number" id="guess-input" min="1" max="100" placeholder="Enter your guess" style="padding: 10px; font-size: 16px; border: 1px solid var(--border-color, #555); border-radius: 5px; background: var(--window-bg, #1a1a1a); color: var(--text-color, #fff); width: 200px;">
                        <button onclick="makeGuess()" style="padding: 10px 20px; margin-left: 10px; background: linear-gradient(135deg, #667eea, #764ba2); color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 16px;">🎯 Guess!</button>
                    </div>
                    <div id="guess-feedback" style="font-size: 18px; margin: 15px 0; min-height: 25px;"></div>
                    <div id="guess-attempts" style="font-size: 16px; margin: 10px 0;">Attempts: 0</div>
                    <div style="display: flex; gap: 10px; justify-content: center; margin-top: 20px;">
                        <button onclick="resetGuessingGame()" style="padding: 10px 20px; background: linear-gradient(135deg, #51cf66, #2ecc71); color: white; border: none; border-radius: 5px; cursor: pointer;">🆕 New Game</button>
                        <button onclick="giveHint()" style="padding: 10px 20px; background: linear-gradient(135deg, #ffd43b, #f39c12); color: white; border: none; border-radius: 5px; cursor: pointer;">💡 Hint</button>
                    </div>
                `;
                
                window.guessingGame = {
                    number: Math.floor(Math.random() * 100) + 1,
                    attempts: 0,
                    hintsUsed: 0
                };
            }
        }

        function makeGuess() {
            const input = document.getElementById('guess-input');
            const feedback = document.getElementById('guess-feedback');
            const attempts = document.getElementById('guess-attempts');
            
            if (!input || !feedback || !attempts || !window.guessingGame) return;
            
            const guess = parseInt(input.value);
            if (isNaN(guess) || guess < 1 || guess > 100) {
                feedback.textContent = '⚠️ Please enter a number between 1 and 100!';
                feedback.style.color = '#ffd43b';
                return;
            }
            
            window.guessingGame.attempts++;
            attempts.textContent = `Attempts: ${window.guessingGame.attempts}`;
            
            const difference = Math.abs(guess - window.guessingGame.number);
            
            if (guess === window.guessingGame.number) {
                feedback.textContent = `🎉 Congratulations! You guessed it in ${window.guessingGame.attempts} attempts!`;
                feedback.style.color = '#51cf66';
                showNotification(`🎉 You won the guessing game in ${window.guessingGame.attempts} attempts!`, 'success');
                
                // Disable input
                input.disabled = true;
            } else if (difference <= 5) {
                feedback.textContent = guess < window.guessingGame.number ? '🔥 Very close! Try a bit higher!' : '🔥 Very close! Try a bit lower!';
                feedback.style.color = '#ff6b6b';
            } else if (difference <= 15) {
                feedback.textContent = guess < window.guessingGame.number ? '🌡️ Getting warm! Try higher!' : '🌡️ Getting warm! Try lower!';
                feedback.style.color = '#ffd43b';
            } else {
                feedback.textContent = guess < window.guessingGame.number ? '❄️ Too low! Try much higher!' : '❄️ Too high! Try much lower!';
                feedback.style.color = '#74c0fc';
            }
            
            input.value = '';
            input.focus();
        }

        function giveHint() {
            if (!window.guessingGame) return;
            
            window.guessingGame.hintsUsed++;
            const feedback = document.getElementById('guess-feedback');
            
            if (window.guessingGame.hintsUsed === 1) {
                const isEven = window.guessingGame.number % 2 === 0;
                feedback.textContent = `💡 Hint: The number is ${isEven ? 'even' : 'odd'}!`;
                feedback.style.color = '#74c0fc';
            } else if (window.guessingGame.hintsUsed === 2) {
                const range = window.guessingGame.number <= 50 ? '1-50' : '51-100';
                feedback.textContent = `💡 Hint: The number is between ${range}!`;
                feedback.style.color = '#74c0fc';
            } else {
                feedback.textContent = '💡 No more hints available!';
                feedback.style.color = '#888';
            }
        }

        function resetGuessingGame() {
            window.guessingGame = {
                number: Math.floor(Math.random() * 100) + 1,
                attempts: 0,
                hintsUsed: 0
            };
            const feedback = document.getElementById('guess-feedback');
            const attempts = document.getElementById('guess-attempts');
            const input = document.getElementById('guess-input');
            
            if (feedback) {
                feedback.textContent = '';
                feedback.style.color = 'var(--text-color, #fff)';
            }
            if (attempts) attempts.textContent = 'Attempts: 0';
            if (input) {
                input.value = '';
                input.disabled = false;
                input.focus();
            }
            showNotification('🆕 New guessing game started!', 'info');
        }

        // Email Application
        function openEmail() {
            const content = `
                <div style="display: flex; height: 100%;">
                    <div style="width: 200px; border-right: 1px solid var(--border-color, #555); padding: 10px; background: var(--window-header, #2a2a2a);">
                        <h3>📧 WebOS Mail</h3>
                        <div style="margin: 15px 0;">
                            <div style="padding: 8px; cursor: pointer; border-radius: 4px; transition: all 0.3s;" onclick="showEmailFolder('inbox')" onmouseover="this.style.backgroundColor='rgba(255,255,255,0.1)'" onmouseout="this.style.backgroundColor='transparent'">📥 Inbox (3)</div>
                            <div style="padding: 8px; cursor: pointer; border-radius: 4px; transition: all 0.3s;" onclick="showEmailFolder('sent')" onmouseover="this.style.backgroundColor='rgba(255,255,255,0.1)'" onmouseout="this.style.backgroundColor='transparent'">📤 Sent</div>
                            <div style="padding: 8px; cursor: pointer; border-radius: 4px; transition: all 0.3s;" onclick="showEmailFolder('drafts')" onmouseover="this.style.backgroundColor='rgba(255,255,255,0.1)'" onmouseout="this.style.backgroundColor='transparent'">📝 Drafts</div>
                            <div style="padding: 8px; cursor: pointer; border-radius: 4px; transition: all 0.3s;" onclick="showEmailFolder('trash')" onmouseover="this.style.backgroundColor='rgba(255,255,255,0.1)'" onmouseout="this.style.backgroundColor='transparent'">🗑️ Trash</div>
                        </div>
                        <button onclick="composeEmail()" style="width: 100%; padding: 10px; background: linear-gradient(135deg, #667eea, #764ba2); color: white; border: none; border-radius: 5px; cursor: pointer; transition: all 0.3s;">✏️ Compose</button>
                    </div>
                    <div style="flex: 1; padding: 20px;" id="email-content">
                        <h2>📥 Inbox</h2>
                        <div style="border-bottom: 1px solid var(--border-color, #555); padding: 15px; cursor: pointer; transition: all 0.3s; border-radius: 5px;" onclick="openEmail1()" onmouseover="this.style.backgroundColor='rgba(255,255,255,0.05)'" onmouseout="this.style.backgroundColor='transparent'">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <strong>🐧 WebOS Team</strong>
                                <span style="font-size: 12px; color: #888;">2 hours ago</span>
                            </div>
                            <div style="margin: 5px 0; color: #888;">Welcome to WebOS 3.0!</div>
                            <div style="font-size: 14px;">Discover all the new features in the Penguin edition...</div>
                        </div>
                        <div style="border-bottom: 1px solid var(--border-color, #555); padding: 15px; cursor: pointer; transition: all 0.3s; border-radius: 5px;" onclick="openEmail2()" onmouseover="this.style.backgroundColor='rgba(255,255,255,0.05)'" onmouseout="this.style.backgroundColor='transparent'">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <strong>🔧 System Admin</strong>
                                <span style="font-size: 12px; color: #888;">1 day ago</span>
                            </div>
                            <div style="margin: 5px 0; color: #888;">System Update Available</div>
                            <div style="font-size: 14px;">A new system update is ready for installation...</div>
                        </div>
                        <div style="border-bottom: 1px solid var(--border-color, #555); padding: 15px; cursor: pointer; transition: all 0.3s; border-radius: 5px;" onclick="openEmail3()" onmouseover="this.style.backgroundColor='rgba(255,255,255,0.05)'" onmouseout="this.style.backgroundColor='transparent'">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <strong>👨‍💻 Developer Team</strong>
                                <span style="font-size: 12px; color: #888;">3 days ago</span>
                            </div>
                            <div style="margin: 5px 0; color: #888;">New Features Released</div>
                            <div style="font-size: 14px;">Check out the latest applications and improvements...</div>
                        </div>
                    </div>
                </div>
            `;
            
            createWindow('email', 'Email Client', content, 800, 600);
        }

        function openEmail1() {
            document.getElementById('email-content').innerHTML = `
                <div style="border-bottom: 1px solid var(--border-color, #555); padding-bottom: 15px; margin-bottom: 20px;">
                    <h2>🐧 Welcome to WebOS 3.0!</h2>
                    <div style="margin: 10px 0; color: #888;">
                        <div><strong>From:</strong> WebOS Team &lt;team@webos.local&gt;</div>
                        <div><strong>To:</strong> ${currentUser}@webos.local</div>
                        <div><strong>Date:</strong> ${new Date().toLocaleDateString()}</div>
                        <div><strong>Subject:</strong> Welcome to WebOS 3.0 - Penguin Edition!</div>
                    </div>
                </div>
                <div style="line-height: 1.6;">
                    <p>Dear ${currentUser},</p>
                    <p>🎉 Welcome to WebOS 3.0 "Penguin Edition"! We're thrilled to have you experience our most advanced Linux-like desktop environment yet.</p>
                    
                    <h3>🆕 What's New in This Release:</h3>
                    <ul style="margin: 15px 0; padding-left: 20px;">
                        <li>🐍 <strong>Enhanced Snake Game</strong> - Complete with high scores and smooth gameplay</li>
                        <li>🔢 <strong>Advanced Calculator</strong> - Full scientific calculator functionality</li>
                        <li>🎵 <strong>Music Player</strong> - Enjoy your favorite tunes while working</li>
                        <li>🐧 <strong>Penguin ASCII Art</strong> - Beautiful neofetch display with Linux penguin</li>
                        <li>🎨 <strong>New Themes</strong> - Including a stunning neon theme</li>
                        <li>⚡ <strong>Performance Improvements</strong> - Faster and more responsive</li>
                    </ul>

                    <h3>🚀 Getting Started:</h3>
                    <ol style="margin: 15px 0; padding-left: 20px;">
                        <li>Open the Terminal and try <code style="background: rgba(255,255,255,0.1); padding: 2px 5px; border-radius: 3px;">neofetch</code> to see the penguin!</li>
                        <li>Explore the File Explorer to navigate your virtual file system</li>
                        <li>Play the enhanced Snake game and try to beat the high score</li>
                        <li>Customize your desktop with different themes and wallpapers</li>
                        <li>Use the calculator for your daily computations</li>
                    </ol>

                    <p>🔗 <strong>Useful Commands to Try:</strong></p>
                    <div style="background: rgba(255,255,255,0.05); padding: 15px; border-radius: 5px; margin: 15px 0; font-family: monospace;">
                        neofetch    # Display system info with penguin<br>
                        ls -la      # List files with details<br>
                        cowsay      # Make a cow say something<br>
                        fortune     # Get a random fortune<br>
                        figlet      # Create ASCII art text
                    </div>

                    <p>If you have any questions or feedback, feel free to reach out. Enjoy exploring WebOS!</p>
                    
                    <p>Best regards,<br>
                    🐧 The WebOS Development Team</p>
                </div>
                <div style="margin-top: 30px; padding-top: 15px; border-top: 1px solid var(--border-color, #555);">
                    <button onclick="showEmailFolder('inbox')" style="padding: 8px 16px; margin-right: 10px; background: var(--window-header, #3a3a3a); color: var(--text-color, #fff); border: 1px solid var(--border-color, #555); border-radius: 4px; cursor: pointer;">← Back to Inbox</button>
                    <button onclick="replyEmail()" style="padding: 8px 16px; background: linear-gradient(135deg, #667eea, #764ba2); color: white; border: none; border-radius: 4px; cursor: pointer;">↩️ Reply</button>
                </div>
            `;
        }

        function openEmail2() {
            document.getElementById('email-content').innerHTML = `
                <div style="border-bottom: 1px solid var(--border-color, #555); padding-bottom: 15px; margin-bottom: 20px;">
                    <h2>🔧 System Update Available</h2>
                    <div style="margin: 10px 0; color: #888;">
                        <div><strong>From:</strong> System Admin &lt;admin@webos.local&gt;</div>
                        <div><strong>To:</strong> ${currentUser}@webos.local</div>
                        <div><strong>Date:</strong> ${new Date(Date.now() - 86400000).toLocaleDateString()}</div>
                        <div><strong>Subject:</strong>System Update Available - WebOS 3.0.1</div>
                    </div>
                </div>
                <div style="line-height: 1.6;">
                    <p>Hello ${currentUser},</p>
                    <p>A new system update is available for your WebOS installation.</p>
                    
                    <div style="background: rgba(102, 126, 234, 0.1); border-left: 4px solid #667eea; padding: 15px; margin: 20px 0;">
                        <h3>📦 WebOS 3.0.1 Update Details:</h3>
                        <ul style="margin: 10px 0; padding-left: 20px;">
                            <li>🐛 Bug fixes for terminal commands</li>
                            <li>🎮 Snake game performance improvements</li>
                            <li>🔒 Security enhancements</li>
                            <li>🎨 UI/UX improvements</li>
                        </ul>
                    </div>

                    <p><strong>Installation:</strong> The update will be applied automatically during your next login.</p>
                    <p><strong>Downtime:</strong> Minimal - less than 30 seconds</p>
                    
                    <p>Thank you for keeping your WebOS system up to date!</p>
                    
                    <p>Best regards,<br>
                    🔧 WebOS System Administration</p>
                </div>
                <div style="margin-top: 30px; padding-top: 15px; border-top: 1px solid var(--border-color, #555);">
                    <button onclick="showEmailFolder('inbox')" style="padding: 8px 16px; margin-right: 10px; background: var(--window-header, #3a3a3a); color: var(--text-color, #fff); border: 1px solid var(--border-color, #555); border-radius: 4px; cursor: pointer;">← Back to Inbox</button>
                </div>
            `;
        }

        function openEmail3() {
            document.getElementById('email-content').innerHTML = `
                <div style="border-bottom: 1px solid var(--border-color, #555); padding-bottom: 15px; margin-bottom: 20px;">
                    <h2>👨‍💻 New Features Released</h2>
                    <div style="margin: 10px 0; color: #888;">
                        <div><strong>From:</strong> Developer Team &lt;dev@webos.local&gt;</div>
                        <div><strong>To:</strong> ${currentUser}@webos.local</div>
                        <div><strong>Date:</strong> ${new Date(Date.now() - 259200000).toLocaleDateString()}</div>
                        <div><strong>Subject:</strong> Exciting New Features in WebOS</div>
                    </div>
                </div>
                <div style="line-height: 1.6;">
                    <p>Hi ${currentUser},</p>
                    <p>We're excited to announce several new features that have been added to WebOS!</p>
                    
                    <h3>🎉 New Applications:</h3>
                    <ul style="margin: 15px 0; padding-left: 20px;">
                        <li>🎵 <strong>Music Player</strong> - Complete with playlist support</li>
                        <li>🔢 <strong>Calculator</strong> - Scientific calculator with memory functions</li>
                        <li>🎮 <strong>Enhanced Games</strong> - Improved Snake game with high scores</li>
                    </ul>

                    <h3>🔧 System Improvements:</h3>
                    <ul style="margin: 15px 0; padding-left: 20px;">
                        <li>📊 Enhanced system monitor with network stats</li>
                        <li>📁 Improved file explorer with new folder creation</li>
                        <li>🌐 Better web browser with multiple pages</li>
                        <li>📝 Code editor with syntax highlighting support</li>
                    </ul>

                    <p>We're constantly working to improve your WebOS experience. Keep an eye out for more updates!</p>
                    
                    <p>Happy computing!<br>
                    👨‍💻 The WebOS Development Team</p>
                </div>
                <div style="margin-top: 30px; padding-top: 15px; border-top: 1px solid var(--border-color, #555);">
                    <button onclick="showEmailFolder('inbox')" style="padding: 8px 16px; margin-right: 10px; background: var(--window-header, #3a3a3a); color: var(--text-color, #fff); border: 1px solid var(--border-color, #555); border-radius: 4px; cursor: pointer;">← Back to Inbox</button>
                </div>
            `;
        }

        function showEmailFolder(folder) {
            const content = document.getElementById('email-content');
            if (folder === 'inbox') {
                openEmail(); // Reload inbox
            } else {
                content.innerHTML = `
                    <h2>📁 ${folder.charAt(0).toUpperCase() + folder.slice(1)}</h2>
                    <div style="text-align: center; padding: 50px; color: #888;">
                        <div style="font-size: 48px; margin-bottom: 20px;">📭</div>
                        <p>This folder is empty.</p>
                    </div>
                `;
            }
        }

        function composeEmail() {
            document.getElementById('email-content').innerHTML = `
                <h2>✏️ Compose New Email</h2>
                <div style="margin: 20px 0;">
                    <div style="margin: 10px 0;">
                        <label style="display: block; margin-bottom: 5px;"><strong>To:</strong></label>
                        <input type="email" placeholder="recipient@webos.local" style="width: 100%; padding: 8px; background: var(--window-bg, #1a1a1a); color: var(--text-color, #fff); border: 1px solid var(--border-color, #555); border-radius: 4px;">
                    </div>
                    <div style="margin: 10px 0;">
                        <label style="display: block; margin-bottom: 5px;"><strong>Subject:</strong></label>
                        <input type="text" placeholder="Email subject" style="width: 100%; padding: 8px; background: var(--window-bg, #1a1a1a); color: var(--text-color, #fff); border: 1px solid var(--border-color, #555); border-radius: 4px;">
                    </div>
                    <div style="margin: 10px 0;">
                        <label style="display: block; margin-bottom: 5px;"><strong>Message:</strong></label>
                        <textarea placeholder="Type your message here..." style="width: 100%; height: 200px; padding: 8px; background: var(--window-bg, #1a1a1a); color: var(--text-color, #fff); border: 1px solid var(--border-color, #555); border-radius: 4px; resize: vertical;"></textarea>
                    </div>
                    <div style="margin: 20px 0;">
                        <button onclick="sendEmail()" style="padding: 10px 20px; margin-right: 10px; background: linear-gradient(135deg, #667eea, #764ba2); color: white; border: none; border-radius: 5px; cursor: pointer;">📤 Send</button>
                        <button onclick="saveDraft()" style="padding: 10px 20px; margin-right: 10px; background: var(--window-header, #3a3a3a); color: var(--text-color, #fff); border: 1px solid var(--border-color, #555); border-radius: 5px; cursor: pointer;">💾 Save Draft</button>
                        <button onclick="showEmailFolder('inbox')" style="padding: 10px 20px; background: var(--window-header, #3a3a3a); color: var(--text-color, #fff); border: 1px solid var(--border-color, #555); border-radius: 5px; cursor: pointer;">❌ Cancel</button>
                    </div>
                </div>
            `;
        }

        function sendEmail() {
            showNotification('📤 Email sent successfully!', 'success');
            showEmailFolder('inbox');
        }

        function saveDraft() {
            showNotification('💾 Email saved to drafts', 'info');
        }

        function replyEmail() {
            showNotification('↩️ Reply functionality coming soon!', 'info');
        }

        // Calendar Application
        function openCalendar() {
            const now = new Date();
            const content = `
                <div style="padding: 20px;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <h2>📅 Calendar</h2>
                        <div style="display: flex; gap: 10px; align-items: center;">
                            <button onclick="changeMonth(-1)" style="padding: 5px 10px; background: var(--window-header, #3a3a3a); color: var(--text-color, #fff); border: 1px solid var(--border-color, #555); border-radius: 3px; cursor: pointer;">←</button>
                            <span id="calendar-month" style="font-size: 18px; font-weight: bold;">${now.toLocaleDateString('en-US', { month: 'long', year: 'numeric' })}</span>
                            <button onclick="changeMonth(1)" style="padding: 5px 10px; background: var(--window-header, #3a3a3a); color: var(--text-color, #fff); border: 1px solid var(--border-color, #555); border-radius: 3px; cursor: pointer;">→</button>
                        </div>
                    </div>
                    <div style="display: grid; grid-template-columns: repeat(7, 1fr); gap: 1px; background: var(--border-color, #555); border-radius: 8px; overflow: hidden; margin-bottom: 20px;">
                        <div style="padding: 15px; background: var(--window-header, #2a2a2a); text-align: center; font-weight: bold;">Sun</div>
                        <div style="padding: 15px; background: var(--window-header, #2a2a2a); text-align: center; font-weight: bold;">Mon</div>
                        <div style="padding: 15px; background: var(--window-header, #2a2a2a); text-align: center; font-weight: bold;">Tue</div>
                        <div style="padding: 15px; background: var(--window-header, #2a2a2a); text-align: center; font-weight: bold;">Wed</div>
                        <div style="padding: 15px; background: var(--window-header, #2a2a2a); text-align: center; font-weight: bold;">Thu</div>
                        <div style="padding: 15px; background: var(--window-header, #2a2a2a); text-align: center; font-weight: bold;">Fri</div>
                        <div style="padding: 15px; background: var(--window-header, #2a2a2a); text-align: center; font-weight: bold;">Sat</div>
                        ${generateCalendarDays(now)}
                    </div>
                    <div>
                        <h3>📝 Today's Events</h3>
                        <div style="border: 1px solid var(--border-color, #555); border-radius: 8px; margin-top: 10px;">
                            <div style="padding: 15px; border-bottom: 1px solid var(--border-color, #555); display: flex; align-items: center;">
                                <div style="width: 10px; height: 10px; background: #667eea; border-radius: 50%; margin-right: 10px;"></div>
                                <div>
                                    <div style="font-weight: bold;">🎯 WebOS Development Meeting</div>
                                    <div style="font-size: 12px; color: #888;">2:00 PM - 3:00 PM</div>
                                </div>
                            </div>
                            <div style="padding: 15px; border-bottom: 1px solid var(--border-color, #555); display: flex; align-items: center;">
                                <div style="width: 10px; height: 10px; background: #51cf66; border-radius: 50%; margin-right: 10px;"></div>
                                <div>
                                    <div style="font-weight: bold;">📚 Code Review Session</div>
                                    <div style="font-size: 12px; color: #888;">4:00 PM - 5:00 PM</div>
                                </div>
                            </div>
                            <div style="padding: 15px; display: flex; align-items: center;">
                                <div style="width: 10px; height: 10px; background: #ff6b6b; border-radius: 50%; margin-right: 10px;"></div>
                                <div>
                                    <div style="font-weight: bold;">🎮 Gaming Tournament</div>
                                    <div style="font-size: 12px; color: #888;">7:00 PM - 9:00 PM</div>
                                </div>
                            </div>
                        </div>
                        <button onclick="addEvent()" style="width: 100%; padding: 10px; margin-top: 15px; background: linear-gradient(135deg, #667eea, #764ba2); color: white; border: none; border-radius: 5px; cursor: pointer;">➕ Add Event</button>
                    </div>
                </div>
            `;
            
            createWindow('calendar', 'Calendar', content, 600, 500);
        }

        function generateCalendarDays(date) {
            const year = date.getFullYear();
            const month = date.getMonth();
            const firstDay = new Date(year, month, 1).getDay();
            const daysInMonth = new Date(year, month + 1, 0).getDate();
            const today = new Date().getDate();
            const currentMonth = new Date().getMonth();
            const currentYear = new Date().getFullYear();
            
            let html = '';
            
            // Empty cells for days before the first day of the month
            for (let i = 0; i < firstDay; i++) {
                html += '<div style="padding: 15px; background: var(--window-bg, #1a1a1a); min-height: 40px;"></div>';
            }
            
            // Days of the month
            for (let day = 1; day <= daysInMonth; day++) {
                const isToday = day === today && month === currentMonth && year === currentYear;
                const bgColor = isToday ? 'linear-gradient(135deg, #667eea, #764ba2)' : 'var(--window-bg, #1a1a1a)';
                const textColor = isToday ? 'white' : 'var(--text-color, #fff)';
                
                html += `<div style="padding: 15px; background: ${bgColor}; color: ${textColor}; min-height: 40px; cursor: pointer; transition: all 0.3s;" onclick="selectDate(${day})" onmouseover="this.style.backgroundColor='rgba(255,255,255,0.1)'" onmouseout="this.style.backgroundColor='${bgColor}'">${day}</div>`;
            }
            
            return html;
        }

        function changeMonth(direction) {
            showNotification(`📅 ${direction > 0 ? 'Next' : 'Previous'} month navigation coming soon!`, 'info');
        }

        function selectDate(day) {
            showNotification(`📅 Selected date: ${day}`, 'info');
        }

        function addEvent() {
            const eventName = prompt('Enter event name:');
            if (eventName) {
                showNotification(`📅 Event "${eventName}" added to calendar`, 'success');
            }
        }

        // Settings Application
        function openSettings() {
            const content = `
                <div style="display: flex; height: 100%;">
                    <div style="width: 200px; border-right: 1px solid var(--border-color, #555); padding: 10px; background: var(--window-header, #2a2a2a);">
                        <h3>⚙️ Settings</h3>
                        <div style="margin: 15px 0;">
                            <div style="padding: 8px; cursor: pointer; border-radius: 4px; transition: all 0.3s;" onclick="showSettingsPage('appearance')" onmouseover="this.style.backgroundColor='rgba(255,255,255,0.1)'" onmouseout="this.style.backgroundColor='transparent'">🎨 Appearance</div>
                            <div style="padding: 8px; cursor: pointer; border-radius: 4px; transition: all 0.3s;" onclick="showSettingsPage('system')" onmouseover="this.style.backgroundColor='rgba(255,255,255,0.1)'" onmouseout="this.style.backgroundColor='transparent'">🖥️ System</div>
                            <div style="padding: 8px; cursor: pointer; border-radius: 4px; transition: all 0.3s;" onclick="showSettingsPage('accounts')" onmouseover="this.style.backgroundColor='rgba(255,255,255,0.1)'" onmouseout="this.style.backgroundColor='transparent'">👤 Accounts</div>
                            <div style="padding: 8px; cursor: pointer; border-radius: 4px; transition: all 0.3s;" onclick="showSettingsPage('privacy')" onmouseover="this.style.backgroundColor='rgba(255,255,255,0.1)'" onmouseout="this.style.backgroundColor='transparent'">🔒 Privacy</div>
                            <div style="padding: 8px; cursor: pointer; border-radius: 4px; transition: all 0.3s;" onclick="showSettingsPage('about')" onmouseover="this.style.backgroundColor='rgba(255,255,255,0.1)'" onmouseout="this.style.backgroundColor='transparent'">ℹ️ About</div>
                        </div>
                    </div>
                    <div style="flex: 1; padding: 20px;" id="settings-content">
                        <h2>🎨 Appearance</h2>
                        <div style="margin: 20px 0;">
                            <h3>Theme Selection</h3>
                            <p style="color: #888; margin-bottom: 15px;">Choose your preferred desktop theme</p>
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 15px; margin: 15px 0;">
                                <button onclick="changeTheme('dark')" style="padding: 15px; background: #2d3748; color: white; border: 1px solid #4a5568; border-radius: 8px; cursor: pointer; transition: all 0.3s;">🌙 Dark</button>
                                <button onclick="changeTheme('light')" style="padding: 15px; background: #ffffff; color: #2d3748; border: 1px solid #e2e8f0; border-radius: 8px; cursor: pointer; transition: all 0.3s;">☀️ Light</button>
                                <button onclick="changeTheme('retro')" style="padding: 15px; background: #000000; color: #00ff00; border: 1px solid #008000; border-radius: 8px; cursor: pointer; transition: all 0.3s;">💻 Retro</button>
                                <button onclick="changeTheme('neon')" style="padding: 15px; background: #0a0a0a; color: #00ffff; border: 1px solid #ff00ff; border-radius: 8px; cursor: pointer; transition: all 0.3s;">✨ Neon</button>
                            </div>
                        </div>
                        <div style="margin: 30px 0;">
                            <h3>Wallpaper Selection</h3>
                            <p style="color: #888; margin-bottom: 15px;">Customize your desktop background</p>
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 15px; margin: 15px 0;">
                                <div onclick="changeWallpaper('wallpaper-1')" style="width: 120px; height: 80px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 8px; cursor: pointer; border: 2px solid transparent; transition: all 0.3s;" onmouseover="this.style.borderColor='#667eea'" onmouseout="this.style.borderColor='transparent'"></div>
                                <div onclick="changeWallpaper('wallpaper-2')" style="width: 120px; height: 80px; background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); border-radius: 8px; cursor: pointer; border: 2px solid transparent; transition: all 0.3s;" onmouseover="this.style.borderColor='#f093fb'" onmouseout="this.style.borderColor='transparent'"></div>
                                <div onclick="changeWallpaper('wallpaper-3')" style="width: 120px; height: 80px; background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); border-radius: 8px; cursor: pointer; border: 2px solid transparent; transition: all 0.3s;" onmouseover="this.style.borderColor='#4facfe'" onmouseout="this.style.borderColor='transparent'"></div>
                                <div onclick="changeWallpaper('wallpaper-4')" style="width: 120px; height: 80px; background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%); border-radius: 8px; cursor: pointer; border: 2px solid transparent; transition: all 0.3s;" onmouseover="this.style.borderColor='#43e97b'" onmouseout="this.style.borderColor='transparent'"></div>
                                <div onclick="changeWallpaper('wallpaper-5')" style="width: 120px; height: 80px; background: linear-gradient(135deg, #fa709a 0%, #fee140 100%); border-radius: 8px; cursor: pointer; border: 2px solid transparent; transition: all 0.3s;" onmouseover="this.style.borderColor='#fa709a'" onmouseout="this.style.borderColor='transparent'"></div>
                            </div>
                        </div>
                        <div style="margin: 30px 0;">
                            <h3>Desktop Icons</h3>
                            <p style="color: #888; margin-bottom: 15px;">Manage desktop icon visibility</p>
                            <label style="display: flex; align-items: center; margin: 10px 0; cursor: pointer;">
                                <input type="checkbox" checked style="margin-right: 10px;"> Show desktop icons
                            </label>
                            <label style="display: flex; align-items: center; margin: 10px 0; cursor: pointer;">
                                <input type="checkbox" checked style="margin-right: 10px;"> Auto-arrange icons
                            </label>
                        </div>
                    </div>
                </div>
            `;
            
            createWindow('settings', 'Settings', content, 700, 500);
        }

        function showSettingsPage(page) {
            const content = document.getElementById('settings-content');
            
            switch(page) {
                case 'system':
                    content.innerHTML = `
                        <h2>🖥️ System Settings</h2>
                        <div style="margin: 20px 0;">
                            <h3>Performance</h3>
                            <label style="display: flex; align-items: center; margin: 10px 0; cursor: pointer;">
                                <input type="checkbox" checked style="margin-right: 10px;"> Enable animations
                            </label>
                            <label style="display: flex; align-items: center; margin: 10px 0; cursor: pointer;">
                                <input type="checkbox" checked style="margin-right: 10px;"> Hardware acceleration
                            </label>
                        </div>
                        <div style="margin: 30px 0;">
                            <h3>Startup</h3>
                            <label style="display: flex; align-items: center; margin: 10px 0; cursor: pointer;">
                                <input type="checkbox" style="margin-right: 10px;"> Auto-login
                            </label>
                            <label style="display: flex; align-items: center; margin: 10px 0; cursor: pointer;">
                                <input type="checkbox" checked style="margin-right: 10px;"> Show boot screen
                            </label>
                        </div>
                        <div style="margin: 30px 0;">
                            <h3>System Information</h3>
                            <div style="background: rgba(255,255,255,0.05); padding: 15px; border-radius: 8px;">
                                <div><strong>OS:</strong> WebOS 3.0 (Penguin Edition)</div>
                                <div><strong>Kernel:</strong> WebOS-Linux 5.15.0</div>
                                <div><strong>Architecture:</strong> x86_64</div>
                                <div><strong>Memory:</strong> ${Math.round((performance.memory?.totalJSHeapSize || 134217728) / 1024 / 1024)} MB</div>
                                <div><strong>Storage:</strong> Virtual File System</div>
                            </div>
                        </div>
                    `;
                    break;
                case 'accounts':
                    content.innerHTML = `
                        <h2>👤 Account Settings</h2>
                        <div style="margin: 20px 0;">
                            <h3>User Profile</h3>
                            <div style="display: flex; align-items: center; margin: 20px 0;">
                                <div style="width: 80px; height: 80px; border-radius: 50%; background: linear-gradient(135deg, #667eea, #764ba2); display: flex; align-items: center; justify-content: center; font-size: 32px; margin-right: 20px;">🐧</div>
                                <div>
                                    <div style="font-size: 24px; font-weight: bold;">${currentUser}</div>
                                    <div style="color: #888;">WebOS User</div>
                                </div>
                            </div>
                            <button onclick="changeAvatar()" style="padding: 10px 20px; background: linear-gradient(135deg, #667eea, #764ba2); color: white; border: none; border-radius: 5px; cursor: pointer; margin-right: 10px;">Change Avatar</button>
                            <button onclick="changePassword()" style="padding: 10px 20px; background: var(--window-header, #3a3a3a); color: var(--text-color, #fff); border: 1px solid var(--border-color, #555); border-radius: 5px; cursor: pointer;">Change Password</button>
                        </div>
                        <div style="margin: 30px 0;">
                            <h3>Account Security</h3>
                            <label style="display: flex; align-items: center; margin: 10px 0; cursor: pointer;">
                                <input type="checkbox" checked style="margin-right: 10px;"> Require password on login
                            </label>
                            <label style="display: flex; align-items: center; margin: 10px 0; cursor: pointer;">
                                <input type="checkbox" style="margin-right: 10px;"> Auto-lock after inactivity
                            </label>
                        </div>
                    `;
                    break;
                case 'privacy':
                    content.innerHTML = `
                        <h2>🔒 Privacy Settings</h2>
                        <div style="margin: 20px 0;">
                            <h3>Data Collection</h3>
                            <label style="display: flex; align-items: center; margin: 10px 0; cursor: pointer;">
                                <input type="checkbox" style="margin-right: 10px;"> Send usage statistics
                            </label>
                            <label style="display: flex; align-items: center; margin: 10px 0; cursor: pointer;">
                                <input type="checkbox" style="margin-right: 10px;"> Crash reporting
                            </label>
                        </div>
                        <div style="margin: 30px 0;">
                            <h3>File System</h3>
                            <label style="display: flex; align-items: center; margin: 10px 0; cursor: pointer;">
                                <input type="checkbox" checked style="margin-right: 10px;"> Save files locally
                            </label>
                            <button onclick="clearData()" style="padding: 10px 20px; background: #ff6b6b; color: white; border: none; border-radius: 5px; cursor: pointer; margin-top: 15px;">🗑️ Clear All Data</button>
                        </div>
                    `;
                    break;
                case 'about':
                    content.innerHTML = `
                        <h2>ℹ️ About WebOS</h2>
                        <div style="text-align: center; margin: 30px 0;">
                            <div style="font-size: 64px; margin-bottom: 20px;">🐧</div>
                            <h1>WebOS 3.0</h1>
                            <p style="font-size: 18px; color: #888; margin: 10px 0;">Penguin Edition</p>
                            <p style="margin: 20px 0;">A complete Linux-like desktop environment for the web</p>
                        </div>
                        <div style="margin: 30px 0;">
                            <h3>Features</h3>
                            <ul style="margin: 15px 0; padding-left: 20px; line-height: 1.8;">
                                <li>🖥️ Full desktop environment with window management</li>
                                <li>🐧 Linux terminal with 40+ commands</li>
                                <li>📁 Virtual file system with persistence</li>
                                <li>🎮 Built-in games including Snake and Tic-Tac-Toe</li>
                                <li>🎵 Music player and calculator applications</li>
                                <li>🎨 Multiple themes and customization options</li>
                                <li>📧 Email client and calendar</li>
                                <li>🌐 Web browser simulation</li>
                                <li>📝 Code editor with syntax highlighting</li>
                                <li>📊 System monitor and performance tracking</li>
                            </ul>
                        </div>
                        <div style="margin: 30px 0;">
                            <h3>System Information</h3>
                            <div style="background: rgba(255,255,255,0.05); padding: 15px; border-radius: 8px; font-family: monospace;">
                                <div>Version: 3.0.0 (Penguin Edition)</div>
                                <div>Build: ${new Date().toISOString().split('T')[0].replace(/-/g, '')}</div>
                                <div>Kernel: WebOS-Linux 5.15.0</div>
                                <div>Desktop: WebOS Desktop Environment</div>
                                <div>License: Open Source</div>
                            </div>
                        </div>
                        <div style="text-align: center; margin: 30px 0;">
                            <p style="color: #888;">Made with ❤️ for the open source community</p>
                        </div>
                    `;
                    break;
                default:
                    // Appearance page (default)
                    openSettings();
            }
        }

        function changeTheme(theme) {
            const desktop = document.getElementById('desktop');
            desktop.className = desktop.className.replace(/theme-\w+/, '') + ` theme-${theme}`;
            showNotification(`🎨 Theme changed to ${theme}`, 'success');
            localStorage.setItem('webos_theme', theme);
        }

        function changeWallpaper(wallpaper) {
            const desktop = document.getElementById('desktop');
            desktop.className = desktop.className.replace(/wallpaper-\w+/, '') + ` ${wallpaper}`;
            showNotification('🖼️ Wallpaper changed', 'success');
            localStorage.setItem('webos_wallpaper', wallpaper);
        }

        function changeAvatar() {
            showNotification('👤 Avatar change coming soon!', 'info');
        }

        function changePassword() {
            showNotification('🔒 Password change coming soon!', 'info');
        }

        function clearData() {
            if (confirm('Are you sure you want to clear all data? This action cannot be undone.')) {
                localStorage.clear();
                showNotification('🗑️ All data cleared', 'warning');
            }
        }

        // Recycle Bin Application
        function openRecycleBin() {
            const content = `
                <div style="padding: 20px;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <h2>🗑️ Recycle Bin</h2>
                        <div>
                            <button onclick="restoreAll()" style="padding: 8px 16px; background: linear-gradient(135deg, #51cf66, #2ecc71); color: white; border: none; border-radius: 4px; cursor: pointer; margin-right: 10px;">↩️ Restore All</button>
                            <button onclick="emptyBin()" style="padding: 8px 16px; background: linear-gradient(135deg, #ff6b6b, #e74c3c); color: white; border: none; border-radius: 4px; cursor: pointer;">🗑️ Empty Bin</button>
                        </div>
                    </div>
                    <div>
                        <div style="display: flex; align-items: center; padding: 15px; border-bottom: 1px solid var(--border-color, #555); transition: all 0.3s;" onmouseover="this.style.backgroundColor='rgba(255,255,255,0.05)'" onmouseout="this.style.backgroundColor='transparent'">
                            <div style="margin-right: 15px; font-size: 24px;">📄</div>
                            <div style="flex: 1;">
                                <div style="font-weight: bold;">old_document.txt</div>
                                <div style="font-size: 12px; color: #888;">Deleted 2 days ago • 1.2 KB</div>
                            </div>
                            <button onclick="restoreFile('old_document.txt')" style="padding: 6px 12px; background: linear-gradient(135deg, #667eea, #764ba2); color: white; border: none; border-radius: 4px; cursor: pointer;">↩️ Restore</button>
                        </div>
                        <div style="display: flex; align-items: center; padding: 15px; border-bottom: 1px solid var(--border-color, #555); transition: all 0.3s;" onmouseover="this.style.backgroundColor='rgba(255,255,255,0.05)'" onmouseout="this.style.backgroundColor='transparent'">
                            <div style="margin-right: 15px; font-size: 24px;">📁</div>
                            <div style="flex: 1;">
                                <div style="font-weight: bold;">temp_folder</div>
                                <div style="font-size: 12px; color: #888;">Deleted 1 week ago • Folder</div>
                            </div>
                            <button onclick="restoreFile('temp_folder')" style="padding: 6px 12px; background: linear-gradient(135deg, #667eea, #764ba2); color: white; border: none; border-radius: 4px; cursor: pointer;">↩️ Restore</button>
                        </div>
                        <div style="display: flex; align-items: center; padding: 15px; border-bottom: 1px solid var(--border-color, #555); transition: all 0.3s;" onmouseover="this.style.backgroundColor='rgba(255,255,255,0.05)'" onmouseout="this.style.backgroundColor='transparent'">
                            <div style="margin-right: 15px; font-size: 24px;">🖼️</div>
                            <div style="flex: 1;">
                                <div style="font-weight: bold;">screenshot.png</div>
                                <div style="font-size: 12px; color: #888;">Deleted 3 days ago • 245 KB</div>
                            </div>
                            <button onclick="restoreFile('screenshot.png')" style="padding: 6px 12px; background: linear-gradient(135deg, #667eea, #764ba2); color: white; border: none; border-radius: 4px; cursor: pointer;">↩️ Restore</button>
                        </div>
                    </div>
                    <div style="text-align: center; padding: 30px; color: #888;">
                        <p>💡 Tip: Files in the recycle bin are automatically deleted after 30 days</p>
                    </div>
                </div>
            `;
            
            createWindow('recycle-bin', 'Recycle Bin', content, 600, 400);
        }

        function restoreFile(filename) {
            showNotification(`↩️ Restored ${filename}`, 'success');
        }

        function restoreAll() {
            showNotification('↩️ All files restored', 'success');
        }

        function emptyBin() {
            if (confirm('Are you sure you want to permanently delete all items in the recycle bin?')) {
                showNotification('🗑️ Recycle bin emptied', 'warning');
            }
        }

        // Context Menu Functions
        function showContextMenu(e) {
            e.preventDefault();
            const contextMenu = document.getElementById('context-menu');
            contextMenu.style.display = 'block';
            contextMenu.style.left = e.clientX + 'px';
            contextMenu.style.top = e.clientY + 'px';
        }

        function hideContextMenu() {
            document.getElementById('context-menu').style.display = 'none';
        }

        function refreshDesktop() {
            hideContextMenu();
            showNotification('🔄 Desktop refreshed', 'info');
        }

        // Start Menu Functions
        function toggleStartMenu() {
            const startMenu = document.getElementById('start-menu-panel');
            startMenu.style.display = startMenu.style.display === 'flex' ? 'none' : 'flex';
        }

        // System Tray Functions
        function toggleVolume() {
            showNotification('🔊 Volume: 75%', 'info');
        }

        function toggleNetwork() {
            showNotification('📶 Network: Connected (192.168.1.100)', 'info');
        }

        function toggleBattery() {
            showNotification('🔋 Battery: 85% (Charging)', 'info');
        }

        // Window Dragging
        function startDrag(e) {
            const header = e.target.closest('.window-header');
            if (header) {
                const window = header.closest('.window');
                if (window && !window.classList.contains('maximized')) {
                    draggedElement = window;
                    const rect = window.getBoundingClientRect();
                    dragOffset.x = e.clientX - rect.left;
                    dragOffset.y = e.clientY - rect.top;
                    
                    window.style.zIndex = ++windowZIndex;
                    document.querySelectorAll('.window').forEach(w => w.classList.remove('active'));
                    window.classList.add('active');
                }
            }
        }

        function drag(e) {
            if (draggedElement && draggedElement.classList.contains('window')) {
                e.preventDefault();
                const x = e.clientX - dragOffset.x;
                const y = e.clientY - dragOffset.y;
                
                const maxX = window.innerWidth - draggedElement.offsetWidth;
                const maxY = window.innerHeight - draggedElement.offsetHeight - 50;
                
                draggedElement.style.left = Math.max(0, Math.min(x, maxX)) + 'px';
                draggedElement.style.top = Math.max(0, Math.min(y, maxY)) + 'px';
            }
        }

        function endDrag() {
            draggedElement = null;
        }

        // Clipboard Functions
        function copyToClipboard() {
            if (selectedIcons.length > 0) {
                clipboard = selectedIcons.map(icon => icon.dataset.app).join(',');
                showNotification(`📋 Copied ${selectedIcons.length} item(s)`, 'info');
            }
        }

        function pasteFromClipboard() {
            if (clipboard) {
                showNotification('📋 Paste operation simulated', 'info');
            }
        }

        // Terminal Class
        class WebTerminal {
            constructor() {
                this.currentPath = `/home/${currentUser}`;
                this.history = [];
                this.historyIndex = -1;
                this.sudoMode = false;
                this.commands = {
                    'help': this.help.bind(this),
                    'ls': this.ls.bind(this),
                    'pwd': this.pwd.bind(this),
                    'cd': this.cd.bind(this),
                    'cat': this.cat.bind(this),
                    'echo': this.echo.bind(this),
                    'clear': this.clear.bind(this),
                    'whoami': this.whoami.bind(this),
                    'date': this.date.bind(this),
                    'uname': this.uname.bind(this),
                    'neofetch': this.neofetch.bind(this),
                    'mkdir': this.mkdir.bind(this),
                    'touch': this.touch.bind(this),
                    'rm': this.rm.bind(this),
                    'cp': this.cp.bind(this),
                    'mv': this.mv.bind(this),
                    'history': this.showHistory.bind(this),
                    'sudo': this.sudo.bind(this),
                    'exit': this.exitSudo.bind(this),
                    'ping': this.ping.bind(this),
                    'ifconfig': this.ifconfig.bind(this),
                    'ps': this.ps.bind(this),
                    'top': this.top.bind(this),
                    'df': this.df.bind(this),
                    'free': this.free.bind(this),
                    'uptime': this.uptime.bind(this),
                    'cowsay': this.cowsay.bind(this),
                    'fortune': this.fortune.bind(this),
                    'figlet': this.figlet.bind(this),
                    'grep': this.grep.bind(this),
                    'find': this.find.bind(this),
                    'wget': this.wget.bind(this),
                    'curl': this.curl.bind(this),
                    'nano': this.nano.bind(this),
                    'vim': this.vim.bind(this),
                    'htop': this.htop.bind(this),
                    'lscpu': this.lscpu.bind(this),
                    'lsblk': this.lsblk.bind(this),
                    'mount': this.mount.bind(this),
                    'systemctl': this.systemctl.bind(this),
                    'service': this.service.bind(this),
                    'crontab': this.crontab.bind(this),
                    'tar': this.tar.bind(this),
                    'zip': this.zip.bind(this),
                    'unzip': this.unzip.bind(this),
                    'ssh': this.ssh.bind(this),
                    'scp': this.scp.bind(this),
                    'rsync': this.rsync.bind(this),
                    'git': this.git.bind(this),
                    'python': this.python.bind(this),
                    'node': this.node.bind(this),
                    'npm': this.npm.bind(this),
                    'docker': this.docker.bind(this)
                };
                this.init();
            }

            init() {
                this.input = document.getElementById('command-input');
                this.terminalBody = document.getElementById('terminal-body');
                this.promptElement = document.getElementById('prompt');
                
                if (this.input) {
                    this.input.addEventListener('keydown', (e) => {
                        if (e.key === 'Enter') {
                            this.executeCommand();
                        } else if (e.key === 'ArrowUp') {
                            e.preventDefault();
                            this.navigateHistory(-1);
                        } else if (e.key === 'ArrowDown') {
                            e.preventDefault();
                            this.navigateHistory(1);
                        } else if (e.key === 'Tab') {
                            e.preventDefault();
                            this.autoComplete();
                        }
                    });

                    this.input.focus();
                    this.updatePrompt();
                }
            }

            updatePrompt() {
                if (this.promptElement) {
                    const user = this.sudoMode ? 'root' : currentUser;
                    const symbol = this.sudoMode ? '#' : '$';
                    const shortPath = this.currentPath.replace(`/home/${currentUser}`, '~');
                    this.promptElement.textContent = `${user}@webos:${shortPath}${symbol}`;
                    this.promptElement.className = this.sudoMode ? 'prompt-text sudo' : 'prompt-text';
                }
            }

            executeCommand() {
                const command = this.input.value.trim();
                if (command) {
                    this.history.push(command);
                    this.historyIndex = this.history.length;
                    
                    const user = this.sudoMode ? 'root' : currentUser;
                    const symbol = this.sudoMode ? '#' : '$';
                    const shortPath = this.currentPath.replace(`/home/${currentUser}`, '~');
                    this.addOutput(`${user}@webos:${shortPath}${symbol} ${command}`);
                    
                    const [cmd, ...args] = command.split(' ');
                    
                    if (this.commands[cmd]) {
                        this.commands[cmd](args);
                    } else {
                        this.addOutput(`bash: ${cmd}: command not found`, 'error');
                        this.addOutput(`Try 'help' to see available commands`, 'info');
                    }
                }
                
                this.input.value = '';
                this.createNewPrompt();
                this.scrollToBottom();
            }

            autoComplete() {
                const input = this.input.value;
                const commands = Object.keys(this.commands);
                const matches = commands.filter(cmd => cmd.startsWith(input));
                
                if (matches.length === 1) {
                    this.input.value = matches[0] + ' ';
                } else if (matches.length > 1) {
                    this.addOutput(`Possible completions: ${matches.join(', ')}`, 'info');
                    this.createNewPrompt();
                }
            }

            addOutput(text, className = '') {
                if (this.terminalBody) {
                    const output = document.createElement('div');
                    output.className = `output ${className}`;
                    output.textContent = text;
                    this.terminalBody.insertBefore(output, this.terminalBody.lastElementChild);
                }
            }

            createNewPrompt() {
                if (this.terminalBody) {
                    const inputLine = this.terminalBody.lastElementChild;
                    const user = this.sudoMode ? 'root' : currentUser;
                    const symbol = this.sudoMode ? '#' : '$';
                    const shortPath = this.currentPath.replace(`/home/${currentUser}`, '~');
                    const promptClass = this.sudoMode ? 'prompt-text sudo' : 'prompt-text';
                    
                    inputLine.innerHTML = `<span class="${promptClass}" id="prompt">${user}@webos:${shortPath}${symbol}</span><input type="text" class="input-field" id="command-input" autocomplete="off" spellcheck="false">`;
                    this.input = document.getElementById('command-input');
                    this.promptElement = document.getElementById('prompt');
                    
                    this.input.addEventListener('keydown', (e) => {
                        if (e.key === 'Enter') {
                            this.executeCommand();
                        } else if (e.key === 'ArrowUp') {
                            e.preventDefault();
                            this.navigateHistory(-1);
                        } else if (e.key === 'ArrowDown') {
                            e.preventDefault();
                            this.navigateHistory(1);
                        } else if (e.key === 'Tab') {
                            e.preventDefault();
                            this.autoComplete();
                        }
                    });
                    this.input.focus();
                }
            }

            navigateHistory(direction) {
                if (direction === -1 && this.historyIndex > 0) {
                    this.historyIndex--;
                    this.input.value = this.history[this.historyIndex];
                } else if (direction === 1 && this.historyIndex < this.history.length - 1) {
                    this.historyIndex++;
                    this.input.value = this.history[this.historyIndex];
                } else if (direction === 1 && this.historyIndex === this.history.length - 1) {
                    this.historyIndex = this.history.length;
                    this.input.value = '';
                }
            }

            scrollToBottom() {
                if (this.terminalBody) {
                    this.terminalBody.scrollTop = this.terminalBody.scrollHeight;
                }
            }

            // Terminal Commands
            help() {
                const helpText = `🐧 WebOS Terminal v3.0 - Available Commands:

📁 File System Commands:
ls        - List directory contents
pwd       - Print working directory  
cd        - Change directory
cat       - Display file contents
mkdir     - Create directory
touch     - Create file
rm        - Remove file/directory
cp        - Copy files or directories
mv        - Move/rename files or directories
find      - Search for files and directories
grep      - Search text patterns in files

📊 System Information:
whoami    - Display current user
date      - Display current date and time
uname     - System information
neofetch  - Display system info with penguin ASCII
ps        - Show running processes
top       - Display system processes
htop      - Interactive process viewer
df        - Display filesystem usage
free      - Display memory usage
uptime    - Show system uptime
lscpu     - Display CPU information
lsblk     - List block devices
mount     - Display mounted filesystems

🌐 Network Commands:
ping      - Send ICMP echo requests
ifconfig  - Configure network interface
wget      - Download files from web
curl      - Transfer data from servers
ssh       - Secure shell remote access
scp       - Secure copy files over network
rsync     - Synchronize files/directories

🔧 System Administration:
sudo      - Execute command as superuser
systemctl - Control systemd services
service   - Control system services
crontab   - Schedule tasks

📦 Archive & Compression:
tar       - Archive files
zip       - Create zip archives
unzip     - Extract zip archives

💻 Development Tools:
git       - Version control system
python    - Python interpreter
node      - Node.js runtime
npm       - Node package manager
docker    - Container platform
nano      - Text editor
vim       - Vi text editor

🎨 Fun Commands:
cowsay    - Make a cow say something
fortune   - Display a random fortune
figlet    - Create ASCII art text

📝 Utility Commands:
echo      - Display text
clear     - Clear terminal
history   - Show command history
exit      - Exit sudo mode

💡 Tips:
- Use Tab for command completion
- Use ↑/↓ arrows for command history
- Try 'neofetch' to see the WebOS penguin!
- Use 'ls -la' for detailed file listings`;
                this.addOutput(helpText, 'info');
            }

            ls(args) {
                const path = this.resolvePath(args[0] || '.');
                const dir = getDirectoryFromPath(path);
                
                if (!dir) {
                    this.addOutput(`ls: cannot access '${args[0] || '.'}': No such file or directory`, 'error');
                    return;
                }

                if (typeof dir === 'string') {
                    this.addOutput(args[0] || path.split('/').pop());
                    return;
                }

                const items = Object.keys(dir).sort();
                if (items.length === 0) {
                    return;
                }

                const showDetails = args.includes('-l') || args.includes('-la');
                const showHidden = args.includes('-a') || args.includes('-la');

                if (showDetails) {
                    this.addOutput('total ' + items.length);
                    items.forEach(item => {
                        if (!showHidden && item.startsWith('.')) return;
                        
                        const itemPath = path === '/' ? `/${item}` : `${path}/${item}`;
                        const itemData = getDirectoryFromPath(itemPath);
                        const isDir = typeof itemData === 'object';
                        const permissions = isDir ? 'drwxr-xr-x' : '-rw-r--r--';
                        const size = isDir ? '4096' : (typeof itemData === 'string' ? itemData.length : '0');
                        const date = new Date().toLocaleDateString();
                        
                        this.addOutput(`${permissions} 1 ${currentUser} ${currentUser} ${size.padStart(8)} ${date} ${item}${isDir ? '/' : ''}`);
                    });
                } else {
                    let output = '';
                    items.forEach(item => {
                        if (!showHidden && item.startsWith('.')) return;
                        
                        const itemPath = path === '/' ? `/${item}` : `${path}/${item}`;
                        const itemData = getDirectoryFromPath(itemPath);
                        
                        if (typeof itemData === 'object') {
                            output += `${item}/  `;
                        } else {
                            output += `${item}  `;
                        }
                    });
                    
                    if (output) this.addOutput(output);
                }
            }

            pwd() {
                this.addOutput(this.currentPath);
            }

            cd(args) {
                const targetPath = args[0] || `/home/${currentUser}`;
                const newPath = this.resolvePath(targetPath);
                const dir = getDirectoryFromPath(newPath);
                
                if (!dir || typeof dir === 'string') {
                    this.addOutput(`cd: ${targetPath}: No such file or directory`, 'error');
                    return;
                }
                
                this.currentPath = newPath;
                this.updatePrompt();
            }

            cat(args) {
                if (!args[0]) {
                    this.addOutput('cat: missing file operand', 'error');
                    return;
                }
                
                const filePath = this.resolvePath(args[0]);
                const file = getDirectoryFromPath(filePath);
                
                if (!file) {
                    this.addOutput(`cat: ${args[0]}: No such file or directory`, 'error');
                } else if (typeof file === 'object') {
                    this.addOutput(`cat: ${args[0]}: Is a directory`, 'error');
                } else {
                    this.addOutput(file);
                }
            }

            echo(args) {
                this.addOutput(args.join(' '));
            }

            clear() {
                if (this.terminalBody) {
                    const outputs = this.terminalBody.querySelectorAll('.output');
                    outputs.forEach(output => output.remove());
                }
            }

            whoami() {
                this.addOutput(this.sudoMode ? 'root' : currentUser);
            }

            date() {
                this.addOutput(new Date().toString());
            }

            uname(args) {
                if (args.includes('-a')) {
                    this.addOutput('Linux webos 5.15.0-webos #1 SMP Web Terminal x86_64 GNU/Linux');
                } else {
                    this.addOutput('Linux');
                }
            }

            neofetch() {
                const penguin = `                    .88888888:.
                   88888888.88888.
                 .8888888888888888.
                 888888888888888888
                 88' _\`88'_  \`88888
                 88 88 88 88  88888
                 88_88_::_88_:88888
                 88:::,::,:::::8888
                 88\`:::::::::'\\8888
                .88\\  \`::::'    8:88.
               8888::.  \\::      ::::.
              .8888::::'  \`      .::::.
             ::::::'     \`\\  /'   ::::.
           .:::::::'       \`\`     :::::.
          .:::::::'                :::::.
         .:::::::'                  ::::::.
        .:::::::'                    :::::::.
       .:::::::'                      ::::::::.
      .:::::::'                        :::::::::.
     .:::::::'                          ::::::::::.
    .:::::::'                            :::::::::::.
   .:::::::'                              ::::::::::::.
  .:::::::'                                :::::::::::::.
 .:::::::'                                  ::::::::::::::.
.:::::::'                                    :::::::::::::::.
:::::::'                                      ::::::::::::::::.`;

                const info = `${penguin}

${this.sudoMode ? 'root' : currentUser}@webos
────────────────────────────────────────
OS: WebOS 3.0 (Penguin Edition)
Kernel: WebOS-Linux 5.15.0-webos
Uptime: ${Math.floor(performance.now() / 1000 / 60)} mins
Packages: 42 (apt)
Shell: bash 5.1.16
Resolution: ${window.screen.width}x${window.screen.height}
DE: WebOS Desktop Environment
WM: WebOS Window Manager
Theme: ${document.getElementById('desktop').className.match(/theme-(\w+)/)?.[1] || 'dark'}
Terminal: webos-terminal
CPU: Virtual Web CPU (4 cores)
GPU: WebGL Renderer
Memory: ${Math.round((performance.memory?.usedJSHeapSize || 67108864) / 1024 / 1024)}MB / ${Math.round((performance.memory?.totalJSHeapSize || 134217728) / 1024 / 1024)}MB

🐧 Welcome to the WebOS experience!`;

                this.addOutput(info, 'ascii-art');
            }

            mkdir(args) {
                if (!args[0]) {
                    this.addOutput('mkdir: missing operand', 'error');
                    return;
                }
                
                const dirPath = this.resolvePath(args[0]);
                const parentPath = dirPath.substring(0, dirPath.lastIndexOf('/')) || '/';
                const dirName = dirPath.substring(dirPath.lastIndexOf('/') + 1);
                
                const parentDir = getDirectoryFromPath(parentPath);
                if (!parentDir || typeof parentDir === 'string') {
                    this.addOutput(`mkdir: cannot create directory '${args[0]}': No such file or directory`, 'error');
                    return;
                }
                
                if (parentDir[dirName]) {
                    this.addOutput(`mkdir: cannot create directory '${args[0]}': File exists`, 'error');
                    return;
                }
                
                parentDir[dirName] = {};
                saveFileSystem();
                this.addOutput(`Directory '${args[0]}' created`, 'success');
            }

            touch(args) {
                if (!args[0]) {
                    this.addOutput('touch: missing file operand', 'error');
                    return;
                }
                
                const filePath = this.resolvePath(args[0]);
                const parentPath = filePath.substring(0, filePath.lastIndexOf('/')) || '/';
                const fileName = filePath.substring(filePath.lastIndexOf('/') + 1);
                
                const parentDir = getDirectoryFromPath(parentPath);
                if (!parentDir || typeof parentDir === 'string') {
                    this.addOutput(`touch: cannot touch '${args[0]}': No such file or directory`, 'error');
                    return;
                }
                
                if (!parentDir[fileName]) {
                    parentDir[fileName] = '';
                    saveFileSystem();
                    this.addOutput(`File '${args[0]}' created`, 'success');
                } else {
                    this.addOutput(`File '${args[0]}' timestamp updated`, 'info');
                }
            }

            rm(args) {
                if (!args[0]) {
                    this.addOutput('rm: missing operand', 'error');
                    return;
                }
                
                const targetPath = this.resolvePath(args[0]);
                const parentPath = targetPath.substring(0, targetPath.lastIndexOf('/')) || '/';
                const targetName = targetPath.substring(targetPath.lastIndexOf('/') + 1);
                
                const parentDir = getDirectoryFromPath(parentPath);
                if (!parentDir || !parentDir[targetName]) {
                    this.addOutput(`rm: cannot remove '${args[0]}': No such file or directory`, 'error');
                    return;
                }
                
                delete parentDir[targetName];
                saveFileSystem();
                this.addOutput(`'${args[0]}' removed`, 'success');
            }

            cp(args) {
                if (args.length < 2) {
                    this.addOutput('cp: missing file operand', 'error');
                    this.addOutput('Usage: cp source destination', 'info');
                    return;
                }

                const sourcePath = this.resolvePath(args[0]);
                const destPath = this.resolvePath(args[1]);
                
                const sourceFile = getDirectoryFromPath(sourcePath);
                if (!sourceFile) {
                    this.addOutput(`cp: cannot stat '${args[0]}': No such file or directory`, 'error');
                    return;
                }

                const destParentPath = destPath.substring(0, destPath.lastIndexOf('/')) || '/';
                const destFileName = destPath.substring(destPath.lastIndexOf('/') + 1);
                
                const destParentDir = getDirectoryFromPath(destParentPath);
                if (!destParentDir || typeof destParentDir === 'string') {
                    this.addOutput(`cp: cannot create '${args[1]}': No such file or directory`, 'error');
                    return;
                }

                if (typeof sourceFile === 'object') {
                    destParentDir[destFileName] = JSON.parse(JSON.stringify(sourceFile));
                } else {
                    destParentDir[destFileName] = sourceFile;
                }
                
                saveFileSystem();
                this.addOutput(`'${args[0]}' copied to '${args[1]}'`, 'success');
            }

            mv(args) {
                if (args.length < 2) {
                    this.addOutput('mv: missing file operand', 'error');
                    this.addOutput('Usage: mv source destination', 'info');
                    return;
                }

                const sourcePath = this.resolvePath(args[0]);
                const destPath = this.resolvePath(args[1]);
                
                const sourceFile = getDirectoryFromPath(sourcePath);
                if (!sourceFile) {
                    this.addOutput(`mv: cannot stat '${args[0]}': No such file or directory`, 'error');
                    return;
                }

                const destParentPath = destPath.substring(0, destPath.lastIndexOf('/')) || '/';
                const destFileName = destPath.substring(destPath.lastIndexOf('/') + 1);
                
                const destParentDir = getDirectoryFromPath(destParentPath);
                if (!destParentDir || typeof destParentDir === 'string') {
                    this.addOutput(`mv: cannot create '${args[1]}': No such file or directory`, 'error');
                    return;
                }

                destParentDir[destFileName] = sourceFile;
                
                const sourceParentPath = sourcePath.substring(0, sourcePath.lastIndexOf('/')) || '/';
                const sourceFileName = sourcePath.substring(sourcePath.lastIndexOf('/') + 1);
                const sourceParentDir = getDirectoryFromPath(sourceParentPath);
                delete sourceParentDir[sourceFileName];

                saveFileSystem();
                this.addOutput(`'${args[0]}' moved to '${args[1]}'`, 'success');
            }

            showHistory() {
                if (this.history.length === 0) {
                    this.addOutput('No commands in history', 'info');
                    return;
                }
                
                this.history.forEach((cmd, index) => {
                    this.addOutput(`${index + 1}  ${cmd}`);
                });
            }

            sudo(args) {
                if (args.length === 0) {
                    if (!this.sudoMode) {
                        this.addOutput('[sudo] password for user: ', 'warning');
                        this.addOutput('Authentication successful', 'success');
                        this.sudoMode = true;
                        this.updatePrompt();
                        this.addOutput('You are now in sudo mode. Type "exit" to return to normal user.', 'warning');
                    } else {
                        this.addOutput('Already in sudo mode', 'info');
                    }
                } else {
                    const [cmd, ...cmdArgs] = args;
                    this.addOutput(`[sudo] Executing: ${cmd} ${cmdArgs.join(' ')}`, 'warning');
                    
                    if (this.commands[cmd]) {
                        const wasSudo = this.sudoMode;
                        this.sudoMode = true;
                        this.commands[cmd](cmdArgs);
                        this.sudoMode = wasSudo;
                    } else {
                        this.addOutput(`sudo: ${cmd}: command not found`, 'error');
                    }
                }
            }

            exitSudo() {
                if (this.sudoMode) {
                    this.sudoMode = false;
                    this.updatePrompt();
                    this.addOutput('Exited sudo mode', 'success');
                } else {
                    this.addOutput('Not in sudo mode', 'info');
                }
            }

            ping(args) {
                const host = args[0] || 'localhost';
                this.addOutput(`PING ${host} (127.0.0.1) 56(84) bytes of data.`);
                
                let count = 0;
                const pingInterval = setInterval(() => {
                    count++;
                    const time = (Math.random() * 10 + 1).toFixed(1);
                    this.addOutput(`64 bytes from ${host} (127.0.0.1): icmp_seq=${count} ttl=64 time=${time} ms`);
                    
                    if (count >= 4) {
                        clearInterval(pingInterval);
                        this.addOutput(`
--- ${host} ping statistics ---
4 packets transmitted, 4 received, 0% packet loss, time 3003ms
rtt min/avg/max/mdev = 1.2/5.5/9.8/3.2 ms`);
                    }
                }, 1000);
            }

            ifconfig() {
                const output = `eth0: flags=4163<UP,BROADCAST,RUNNING,MULTICAST>  mtu 1500
        inet 192.168.1.100  netmask 255.255.255.0  broadcast 192.168.1.255
        inet6 fe80::a00:27ff:fe4e:66a1  prefixlen 64  scopeid 0x20<link>
        ether 08:00:27:4e:66:a1  txqueuelen 1000  (Ethernet)
        RX packets 1234  bytes 567890 (554.5 KiB)
        RX errors 0  dropped 0  overruns 0  frame 0
        TX packets 987  bytes 123456 (120.5 KiB)
        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0

lo: flags=73<UP,LOOPBACK,RUNNING>  mtu 65536
        inet 127.0.0.1  netmask 255.0.0.0
        inet6 ::1  prefixlen 128  scopeid 0x10<host>
        loop  txqueuelen 1000  (Local Loopback)
        RX packets 24  bytes 2040 (1.9 KiB)
        RX errors 0  dropped 0  overruns 0  frame 0
        TX packets 24  bytes 2040 (1.9 KiB)
        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0`;
                
                this.addOutput(output);
            }

            ps() {
                const processes = `  PID TTY          TIME CMD
    1 ?        00:00:01 systemd
    2 ?        00:00:00 kthreadd
  123 pts/0    00:00:00 bash
  456 pts/0    00:00:00 webos-terminal
  789 pts/0    00:00:00 ps`;
                this.addOutput(processes);
            }

            top() {
                const topOutput = `top - ${new Date().toLocaleTimeString()} up ${Math.floor(performance.now() / 1000 / 60)} min,  1 user,  load average: 0.15, 0.10, 0.05
Tasks:   5 total,   1 running,   4 sleeping,   0 stopped,   0 zombie
%Cpu(s):  ${systemStats.cpu.toFixed(1)} us,  1.2 sy,  0.0 ni, ${(100-systemStats.cpu).toFixed(1)} id,  0.0 wa,  0.0 hi,  0.0 si,  0.0 st
MiB Mem :   2048.0 total,   ${(2048 * (100-systemStats.memory) / 100).toFixed(1)} free,    ${(2048 * systemStats.memory / 100).toFixed(1)} used,    512.0 buff/cache

  PID USER      PR  NI    VIRT    RES    SHR S  %CPU  %MEM     TIME+ COMMAND
    1 root      20   0  169364  13940   8796 S   0.0   0.7   0:01.23 systemd
  123 ${currentUser}      20   0   21292   5124   3456 S   0.0   0.3   0:00.12 bash
  456 ${currentUser}      20   0   15432   3892   2134 R   ${systemStats.cpu.toFixed(1)}   0.2   0:00.05 webos-terminal`;
                this.addOutput(topOutput);
            }

            df() {
                const dfOutput = `Filesystem     1K-blocks    Used Available Use% Mounted on
/dev/web           10240    ${Math.round(10240 * systemStats.disk / 100)}      ${Math.round(10240 * (100-systemStats.disk) / 100)}  ${Math.round(systemStats.disk)}% /
tmpfs               1024       0      1024   0% /dev/shm
/dev/web/home       5120    2048      3072  40% /home
/dev/web/desktop    2048    1024      1024  50% /desktop`;
                this.addOutput(dfOutput);
            }

            free() {
                const totalMem = performance.memory?.totalJSHeapSize || 134217728;
                const usedMem = performance.memory?.usedJSHeapSize || 67108864;
                const freeMem = totalMem - usedMem;
                
                const freeOutput = `              total        used        free      shared  buff/cache   available
Mem:        ${Math.round(totalMem/1024)}      ${Math.round(usedMem/1024)}      ${Math.round(freeMem/1024)}           0           0      ${Math.round(freeMem/1024)}
Swap:            0           0           0`;
                this.addOutput(freeOutput);
            }

            uptime() {
                const uptimeSeconds = Math.floor(performance.now() / 1000);
                const hours = Math.floor(uptimeSeconds / 3600);
                const minutes = Math.floor((uptimeSeconds % 3600) / 60);
                
                this.addOutput(`${new Date().toLocaleTimeString()} up ${hours}:${minutes.toString().padStart(2, '0')}, 1 user, load average: 0.15, 0.10, 0.05`);
            }

            cowsay(args) {
                const message = args.join(' ') || 'Hello from WebOS Terminal!';
                const messageLength = message.length;
                const border = '_'.repeat(messageLength + 2);
                
                const cow = `
${border}
< ${message} >
${'-'.repeat(messageLength + 2)}
        \\   ^__^
         \\  (oo)\\_______
            (__)\\       )\\/\\
                ||----w |
                ||     ||`;
                
                this.addOutput(cow, 'ascii-art');
            }

            fortune() {
                const fortunes = [
                    "The best way to predict the future is to invent it.",
                    "Life is what happens to you while you're busy making other plans.",
                    "The only way to do great work is to love what you do.",
                    "Innovation distinguishes between a leader and a follower.",
                    "Welcome to the Matrix. Red pill or blue pill?",
                    "In the terminal, you are the master of your domain.",
                    "sudo makes you powerful, but with great power comes great responsibility.",
                    "The command line is your gateway to infinite possibilities.",
                    "There are only 10 types of people: those who understand binary and those who don't.",
                    "To err is human, but to really foul things up requires a computer.",
                    "Linux: because a PC is a terrible thing to waste.",
                    "UNIX is user friendly. It's just very selective about who its friends are.",
                    "Keyboard not found. Press F1 to continue.",
                    "My software never has bugs. It just develops random features.",
                    "I would love to change the world, but they won't give me the source code.",
                    "If at first you don't succeed, call it version 1.0.",
                    "Programming today is a race between software engineers striving to build bigger and better idiot-proof programs, and the Universe trying to produce bigger and better idiots. So far, the Universe is winning.",
                    "The generation of random numbers is too important to be left to chance.",
                    "The best thing about a boolean is even if you are wrong, you are only off by a bit.",
                    "Linux is only free if your time has no value."
                ];
                
                const randomFortune = fortunes[Math.floor(Math.random() * fortunes.length)];
                this.addOutput(randomFortune, 'success');
            }

            figlet(args) {
                const text = args.join(' ') || 'WEBOS';
                this.addOutput(`
██╗    ██╗███████╗██████╗  ██████╗ ███████╗
██║    ██║██╔════╝██╔══██╗██╔═══██╗██╔════╝
██║ █╗ ██║█████╗  ██████╔╝██║   ██║███████╗
██║███╗██║██╔══╝  ██╔══██╗██║   ██║╚════██║
╚███╔███╔╝███████╗██████╔╝╚██████╔╝███████║
 ╚══╝╚══╝ ╚══════╝╚═════╝  ╚═════╝ ╚══════╝`, 'ascii-art');
            }

            grep(args) {
                if (args.length < 2) {
                    this.addOutput('grep: missing pattern or file', 'error');
                    this.addOutput('Usage: grep pattern file', 'info');
                    return;
                }

                const pattern = args[0];
                const filePath = this.resolvePath(args[1]);
                const file = getDirectoryFromPath(filePath);
                
                if (!file) {
                    this.addOutput(`grep: ${args[1]}: No such file or directory`, 'error');
                    return;
                }
                
                if (typeof file === 'object') {
                    this.addOutput(`grep: ${args[1]}: Is a directory`, 'error');
                    return;
                }
                
                const lines = file.split('\n');
                let found = false;
                
                lines.forEach((line, index) => {
                    if (line.includes(pattern)) {
                        this.addOutput(`${index + 1}: ${line}`);
                        found = true;
                    }
                });
                
                if (!found) {
                    this.addOutput(`No matches found for '${pattern}' in ${args[1]}`, 'info');
                }
            }

            find(args) {
                if (args.length < 1) {
                    this.addOutput('find: missing path', 'error');
                    this.addOutput('Usage: find path [expression]', 'info');
                    return;
                }

                const path = this.resolvePath(args[0]);
                const dir = getDirectoryFromPath(path);
                
                if (!dir) {
                    this.addOutput(`find: '${args[0]}': No such file or directory`, 'error');
                    return;
                }
                
                if (typeof dir !== 'object') {
                    this.addOutput(path);
                    return;
                }
                
                this.addOutput(path);
                this.findRecursive(dir, path, args.slice(1));
            }

            findRecursive(dir, path, args) {
                for (const item in dir) {
                    const itemPath = path === '/' ? `/${item}` : `${path}/${item}`;
                    this.addOutput(itemPath);
                    
                    if (typeof dir[item] === 'object') {
                        this.findRecursive(dir[item], itemPath, args);
                    }
                }
            }

            wget(args) {
                if (args.length < 1) {
                    this.addOutput('wget: missing URL', 'error');
                    this.addOutput('Usage: wget URL', 'info');
                    return;
                }

                const url = args[0];
                this.addOutput(`--2023-06-05 20:32:49--  ${url}`);
                this.addOutput(`Resolving ${url.split('/')[2]}... 192.168.1.1`);
                this.addOutput(`Connecting to ${url.split('/')[2]}|192.168.1.1|:443... connected.`);
                this.addOutput('HTTP request sent, awaiting response... 200 OK');
                this.addOutput('Length: 12345 (12K) [text/html]');
                this.addOutput(`Saving to: '${url.split('/').pop()}'`);
                
                setTimeout(() => {
                    this.addOutput('100%[===================>] 12,345      --.-K/s   in 0.1s');
                    this.addOutput(`2023-06-05 20:32:50 (120 KB/s) - '${url.split('/').pop()}' saved [12345/12345]`);
                    
                    // Create the file in the current directory
                    const fileName = url.split('/').pop();
                    const dir = getDirectoryFromPath(this.currentPath);
                    if (dir && typeof dir === 'object') {
                        dir[fileName] = `Content downloaded from ${url}`;
                        saveFileSystem();
                    }
                }, 2000);
            }

            curl(args) {
                if (args.length < 1) {
                    this.addOutput('curl: try \'curl --help\' for more information', 'error');
                    return;
                }

                const url = args[0];
                this.addOutput(`  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current`);
                this.addOutput(`                                 Dload  Upload   Total   Spent    Left  Speed`);
                
                setTimeout(() => {
                    this.addOutput(`100  1234  100  1234    0     0  12340      0  --:--:-- --:--:-- --:--:-- 12340`);
                    this.addOutput(`<!DOCTYPE html><html><head><title>Example</title></head><body><h1>Example Domain</h1><p>This is a sample response from ${url}</p></body></html>`);
                }, 1000);
            }

            nano(args) {
                if (args.length < 1) {
                    this.addOutput('nano: No file specified', 'info');
                    return;
                }

                const filePath = this.resolvePath(args[0]);
                this.addOutput(`Opening file ${filePath} in nano editor...`, 'info');
                this.addOutput('(This is a simulated editor. In a real terminal, nano would open here)', 'info');
                
                // Open the file in the code editor
                openCodeEditor();
                setTimeout(() => {
                    const file = getDirectoryFromPath(filePath);
                    if (file && typeof file === 'string') {
                        const editor = document.getElementById('editor-textarea');
                        if (editor) {
                            editor.value = file;
                            updateEditorStats();
                        }
                    }
                }, 100);
            }

            vim(args) {
                this.addOutput('Opening vim...', 'info');
                this.addOutput('(This is a simulated editor. In a real terminal, vim would open here)', 'info');
                this.addOutput('Tip: To exit vim, type :q!', 'warning');
            }

            htop() {
                this.addOutput('Starting htop...', 'info');
                this.addOutput('(This is a simulated htop. In a real terminal, htop would open here)', 'info');
                
                // Open the system monitor
                openSystemMonitor();
            }

            lscpu() {
                const output = `Architecture:                    x86_64
CPU op-mode(s):                  32-bit, 64-bit
Byte Order:                      Little Endian
Address sizes:                   39 bits physical, 48 bits virtual
CPU(s):                          4
On-line CPU(s) list:             0-3
Thread(s) per core:              2
Core(s) per socket:              2
Socket(s):                       1
NUMA node(s):                    1
Vendor ID:                       WebOS
CPU family:                      6
Model:                           142
Model name:                      WebOS Virtual CPU @ 2.30GHz
Stepping:                        10
CPU MHz:                         2300.000
BogoMIPS:                        4600.00
Virtualization:                  VT-x
L1d cache:                       32 KiB
L1i cache:                       32 KiB
L2 cache:                        256 KiB
L3 cache:                        6 MiB
NUMA node0 CPU(s):               0-3`;
                this.addOutput(output);
            }

            lsblk() {
                const output = `NAME   MAJ:MIN RM   SIZE RO TYPE MOUNTPOINT
web      8:0    0    10G  0 disk 
├─web1   8:1    0     1G  0 part /boot
└─web2   8:2    0     9G  0 part /
sr0     11:0    1   1.5G  0 rom`;
                this.addOutput(output);
            }

            mount() {
                const output = `sysfs on /sys type sysfs (rw,nosuid,nodev,noexec,relatime)
proc on /proc type proc (rw,nosuid,nodev,noexec,relatime)
udev on /dev type devtmpfs (rw,nosuid,relatime,size=1986460k,nr_inodes=496615,mode=755)
devpts on /dev/pts type devpts (rw,nosuid,noexec,relatime,gid=5,mode=620,ptmxmode=000)
tmpfs on /run type tmpfs (rw,nosuid,noexec,relatime,size=401576k,mode=755)
/dev/web2 on / type ext4 (rw,relatime,errors=remount-ro)
/dev/web1 on /boot type ext2 (rw,relatime)`;
                this.addOutput(output);
            }

            systemctl(args) {
                if (args.length < 1) {
                    this.addOutput('systemctl: command requires a subcommand', 'error');
                    this.addOutput('Usage: systemctl [command] [service]', 'info');
                    return;
                }

                const command = args[0];
                const service = args[1];
                
                if (!service) {
                    this.addOutput('systemctl: no service specified', 'error');
                    return;
                }
                
                switch (command) {
                    case 'status':
                        this.addOutput(`● ${service}.service - ${service.charAt(0).toUpperCase() + service.slice(1)} Service`);
                        this.addOutput(`   Loaded: loaded (/lib/systemd/system/${service}.service; enabled; vendor preset: enabled)`);
                        this.addOutput(`   Active: active (running) since ${new Date().toLocaleString()}`);
                        this.addOutput(`   Main PID: 123 (${service})`);
                        this.addOutput(`   Tasks: 5`);
                        this.addOutput(`   Memory: 24.0M`);
                        this.addOutput(`   CPU: 2.5s`);
                        break;
                    case 'start':
                        this.addOutput(`Started ${service}.service`);
                        break;
                    case 'stop':
                        this.addOutput(`Stopped ${service}.service`);
                        break;
                    case 'restart':
                        this.addOutput(`Restarted ${service}.service`);
                        break;
                    default:
                        this.addOutput(`systemctl: unknown command '${command}'`, 'error');
                }
            }

            service(args) {
                if (args.length < 2) {
                    this.addOutput('service: not enough arguments', 'error');
                    this.addOutput('Usage: service name command', 'info');
                    return;
                }

                const service = args[0];
                const command = args[1];
                
                switch (command) {
                    case 'status':
                        this.addOutput(`${service} is running`);
                        break;
                    case 'start':
                        this.addOutput(`Starting ${service}... done`);
                        break;
                    case 'stop':
                        this.addOutput(`Stopping ${service}... done`);
                        break;
                    case 'restart':
                        this.addOutput(`Restarting ${service}... done`);
                        break;
                    default:
                        this.addOutput(`service: unknown command '${command}'`, 'error');
                }
            }

            crontab(args) {
                if (args.length < 1) {
                    this.addOutput('no crontab for user', 'info');
                    return;
                }

                if (args[0] === '-l') {
                    this.addOutput('# Edit this file to introduce tasks to be run by cron.');
                    this.addOutput('# Each task to run has to be defined through a single line');
                    this.addOutput('# m h dom mon dow command');
                    this.addOutput('0 * * * * echo "Hourly task" >> /tmp/cron.log');
                    this.addOutput('0 0 * * * echo "Daily task" >> /tmp/cron.log');
                } else if (args[0] === '-e') {
                    this.addOutput('Opening crontab editor...', 'info');
                    this.addOutput('(This is a simulated editor. In a real terminal, the crontab editor would open here)', 'info');
                } else {
                    this.addOutput(`crontab: invalid option -- '${args[0]}'`, 'error');
                    this.addOutput('usage: crontab [-u user] file');
                    this.addOutput('       crontab [-u user] [ -e | -l | -r ]');
                }
            }

            tar(args) {
                if (args.length < 2) {
                    this.addOutput('tar: You must specify one of the `-Acdtrux\' options', 'error');
                    return;
                }

                const option = args[0];
                const file = args[1];
                
                if (option === '-xf') {
                    this.addOutput(`Extracting ${file}...`);
                    this.addOutput('file1');
                    this.addOutput('file2');
                    this.addOutput('file3');
                } else if (option === '-cf') {
                    this.addOutput(`Creating ${file}...`);
                    this.addOutput('file1');
                    this.addOutput('file2');
                    this.addOutput('file3');
                } else {
                    this.addOutput(`tar: Invalid option '${option}'`, 'error');
                }
            }

            zip(args) {
                if (args.length < 2) {
                    this.addOutput('zip: not enough arguments', 'error');
                    this.addOutput('usage: zip zipfile files...', 'info');
                    return;
                }

                const zipFile = args[0];
                const files = args.slice(1);
                
                this.addOutput(`adding: ${files.join(' ')} (stored 0%)`);
                this.addOutput(`zip archive created: ${zipFile}`);
            }

            unzip(args) {
                if (args.length < 1) {
                    this.addOutput('unzip: not enough arguments', 'error');
                    this.addOutput('usage: unzip zipfile', 'info');
                    return;
                }

                const zipFile = args[0];
                
                this.addOutput(`Archive:  ${zipFile}`);
                this.addOutput('  inflating: file1');
                this.addOutput('  inflating: file2');
                this.addOutput('  inflating: file3');
            }

            ssh(args) {
                if (args.length < 1) {
                    this.addOutput('ssh: not enough arguments', 'error');
                    this.addOutput('usage: ssh [user@]hostname', 'info');
                    return;
                }

                const target = args[0];
                
                this.addOutput(`Connecting to ${target}...`);
                setTimeout(() => {
                    this.addOutput(`${target}: Connection refused`, 'error');
                }, 1000);
            }

            scp(args) {
                if (args.length < 2) {
                    this.addOutput('scp: not enough arguments', 'error');
                    this.addOutput('usage: scp source destination', 'info');
                    return;
                }

                const source = args[0];
                const destination = args[1];
                
                this.addOutput(`Copying ${source} to ${destination}...`);
                setTimeout(() => {
                    this.addOutput(`${source}: No such file or directory`, 'error');
                }, 1000);
            }

            rsync(args) {
                if (args.length < 2) {
                    this.addOutput('rsync: not enough arguments', 'error');
                    this.addOutput('usage: rsync source destination', 'info');
                    return;
                }

                const source = args[0];
                const destination = args[1];
                
                this.addOutput(`sending incremental file list`);
                this.addOutput(`file1`);
                this.addOutput(`file2`);
                this.addOutput(`file3`);
                this.addOutput(`sent 1,234 bytes  received 42 bytes  2,552.00 bytes/sec`);
                this.addOutput(`total size is 10,240  speedup is 8.03`);
            }

            git(args) {
                if (args.length < 1) {
                    this.addOutput('usage: git [--version] [--help] [-C <path>] [-c <name>=<value>]');
                    this.addOutput('           [--exec-path[=<path>]] [--html-path] [--man-path] [--info-path]');
                    this.addOutput('           [-p | --paginate | -P | --no-pager] [--no-replace-objects] [--bare]');
                    this.addOutput('           [--git-dir=<path>] [--work-tree=<path>] [--namespace=<name>]');
                    this.addOutput('           <command> [<args>]');
                    return;
                }

                const command = args[0];
                
                switch (command) {
                    case 'init':
                        this.addOutput('Initialized empty Git repository in .git/');
                        break;
                    case 'status':
                        this.addOutput('On branch main');
                        this.addOutput('nothing to commit, working tree clean');
                        break;
                    case 'add':
                        if (args.length < 2) {
                            this.addOutput('Nothing specified, nothing added.', 'error');
                        } else {
                            this.addOutput(`Added ${args[1]}`);
                        }
                        break;
                    case 'commit':
                        this.addOutput('[main 1a2b3c4] Commit message');
                        this.addOutput(' 1 file changed, 10 insertions(+), 2 deletions(-)');
                        break;
                    case 'clone':
                        if (args.length < 2) {
                            this.addOutput('You must specify a repository to clone.', 'error');
                        } else {
                            this.addOutput(`Cloning into '${args[1].split('/').pop().replace('.git', '')}'...`);
                            this.addOutput('remote: Enumerating objects: 100, done.');
                            this.addOutput('remote: Counting objects: 100% (100/100), done.');
                            this.addOutput('remote: Compressing objects: 100% (80/80), done.');
                            this.addOutput('Receiving objects: 100% (100/100), 10.00 KiB | 5.00 MiB/s, done.');
                            this.addOutput('Resolving deltas: 100% (20/20), done.');
                        }
                        break;
                    default:
                        this.addOutput(`git: '${command}' is not a git command. See 'git --help'.`, 'error');
                }
            }

            python(args) {
                this.addOutput('Python 3.9.5 (default, May 11 2021, 08:20:37)');
                this.addOutput('[GCC 10.3.0] on linux');
                this.addOutput('Type "help", "copyright", "credits" or "license" for more information.');
                this.addOutput('>>> print("Hello from Python!")');
                this.addOutput('Hello from Python!');
                this.addOutput('>>> exit()');
            }

            node(args) {
                this.addOutput('Welcome to Node.js v16.13.0.');
                this.addOutput('Type ".help" for more information.');
                this.addOutput('> console.log("Hello from Node.js!")');
                this.addOutput('Hello from Node.js!');
                this.addOutput('undefined');
                this.addOutput('> .exit');
            }

            npm(args) {
                if (args.length < 1) {
                    this.addOutput('npm <command>');
                    this.addOutput('Usage:');
                    this.addOutput('npm install        install all the dependencies in your project');
                    this.addOutput('npm install <foo>  add the <foo> dependency to your project');
                    this.addOutput('npm test           run this project\'s tests');
                    this.addOutput('npm run <foo>      run the script named <foo>');
                    this.addOutput('npm <command> -h   quick help on <command>');
                    this.addOutput('npm -l             display usage info for all commands');
                    this.addOutput('npm help <term>    search for help on <term>');
                    return;
                }

                const command = args[0];
                
                switch (command) {
                    case 'install':
                    case 'i':
                        if (args.length < 2) {
                            this.addOutput('added 100 packages, and audited 101 packages in 2s');
                            this.addOutput('found 0 vulnerabilities');
                        } else {
                            this.addOutput(`+ ${args[1]}@1.0.0`);
                            this.addOutput('added 1 package, and audited 101 packages in 1s');
                            this.addOutput('found 0 vulnerabilities');
                        }
                        break;
                    case 'start':
                        this.addOutput('> webos@1.0.0 start');
                        this.addOutput('> node server.js');
                        this.addOutput('Server running at http://localhost:3000/');
                        break;
                    case 'test':
                        this.addOutput('> webos@1.0.0 test');
                        this.addOutput('> jest');
                        this.addOutput('PASS  ./test.js');
                        this.addOutput('✓ renders without crashing (5ms)');
                        this.addOutput('Test Suites: 1 passed, 1 total');
                        this.addOutput('Tests:       1 passed, 1 total');
                        this.addOutput('Snapshots:   0 total');
                        this.addOutput('Time:        1.5s');
                        break;
                    default:
                        this.addOutput(`Unknown command: ${command}`, 'error');
                }
            }

            docker(args) {
                if (args.length < 1) {
                    this.addOutput('Usage:  docker [OPTIONS] COMMAND');
                    this.addOutput('A self-sufficient runtime for containers');
                    this.addOutput('Common Commands:');
                    this.addOutput('  run         Run a command in a new container');
                    this.addOutput('  exec        Run a command in a running container');
                    this.addOutput('  ps          List containers');
                    this.addOutput('  build       Build an image from a Dockerfile');
                    this.addOutput('  pull        Pull an image or a repository from a registry');
                    this.addOutput('  images      List images');
                    return;
                }

                const command = args[0];
                
                switch (command) {
                    case 'ps':
                        this.addOutput('CONTAINER ID   IMAGE          COMMAND       CREATED       STATUS       PORTS                    NAMES');
                        this.addOutput('abc123def456   nginx:latest   "nginx -g…"   2 hours ago   Up 2 hours   0.0.0.0:80->80/tcp       webserver');
                        this.addOutput('def456abc789   redis:latest   "redis-s…"    3 hours ago   Up 3 hours   0.0.0.0:6379->6379/tcp   redis');
                        break;
                    case 'images':
                        this.addOutput('REPOSITORY   TAG       IMAGE ID       CREATED       SIZE');
                        this.addOutput('nginx        latest    ad4c705f24d3   2 weeks ago   133MB');
                        this.addOutput('redis        latest    7614ae9453d1   3 weeks ago   113MB');
                        this.addOutput('node         16        c2c3ca322cb3   1 month ago   910MB');
                        break;
                    case 'run':
                        if (args.length < 2) {
                            this.addOutput('docker: "run" requires at least 1 argument.', 'error');
                        } else {
                            this.addOutput(`Unable to find image '${args[1]}:latest' locally`);
                            this.addOutput(`latest: Pulling from library/${args[1]}`);
                            this.addOutput('d5fd17ec1767: Pull complete');
                            this.addOutput('9c7a54a9f8a2: Pull complete');
                            this.addOutput('Digest: sha256:1234567890abcdef1234567890abcdef1234567890abcdef1234567890abcdef');
                            this.addOutput(`Status: Downloaded newer image for ${args[1]}:latest`);
                            this.addOutput('Hello from Docker!');
                        }
                        break;
                    default:
                        this.addOutput(`docker: '${command}' is not a docker command.`, 'error');
                }
            }

            resolvePath(path) {
                if (!path || path === '.') return this.currentPath;
                if (path === '..') {
                    const parts = this.currentPath.split('/').filter(p => p);
                    parts.pop();
                    return '/' + parts.join('/');
                }
                if (path === '~') return `/home/${currentUser}`;
                if (path.startsWith('~/')) return `/home/${currentUser}/${path.slice(2)}`;
                if (path.startsWith('/')) return path;
                
                if (this.currentPath === '/') {
                    return '/' + path;
                }
                return this.currentPath + '/' + path;
            }
        }

        // Load saved preferences
        window.addEventListener('load', () => {
            const savedTheme = localStorage.getItem('webos_theme');
            const savedWallpaper = localStorage.getItem('webos_wallpaper');
            
            if (savedTheme) {
                setTimeout(() => {
                    changeTheme(savedTheme);
                }, 100);
            }
            
            if (savedWallpaper) {
                setTimeout(() => {
                    changeWallpaper(savedWallpaper);
                }, 100);
            }
        });

        // Hide start menu when clicking outside
        document.addEventListener('click', (e) => {
            const startMenu = document.getElementById('start-menu-panel');
            const startButton = document.querySelector('.start-menu');
            
            if (startMenu && startMenu.style.display === 'flex' && 
                !startMenu.contains(e.target) && 
                !startButton.contains(e.target)) {
                startMenu.style.display = 'none';
            }
        });

        // Prevent context menu on certain elements
        document.addEventListener('contextmenu', (e) => {
            if (e.target.closest('.window') || e.target.closest('.taskbar')) {
                e.preventDefault();
                return false;
            }
        });
    </script>
</body>
</html>
